<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudXchange Admin Panel - Complete Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ“</text></svg>">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --border-radius: 0.5rem;
            --border-radius-sm: 0.25rem;
            --border-radius-lg: 0.75rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Modern Login Container */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-form {
            background: white;
            padding: 3rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .login-logo .subtitle {
            color: var(--secondary-color);
            font-size: 1rem;
            margin-top: 0.25rem;
        }

        /* Modern Form Styles */
        .form-control {
            background: var(--light-color);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background: white;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .error-message {
            color: var(--danger-color);
            text-align: center;
            margin-top: 1rem;
            display: none;
            padding: 0.75rem;
            background: rgba(220, 38, 38, 0.1);
            border-radius: var(--border-radius);
            border: 1px solid rgba(220, 38, 38, 0.2);
        }

        /* Main Content Styles */
        #mainContent {
            display: none;
        }

        /* Modern Sidebar */
        .sidebar {
            background: white;
            width: 280px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            padding: 2rem 0;
            box-shadow: var(--shadow-lg);
            border-right: 1px solid var(--border-color);
        }

        .sidebar-header {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .sidebar h3 {
            color: var(--primary-color);
            font-size: 1.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sidebar-subtitle {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* Modern Navigation */
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.875rem 2rem;
            color: var(--secondary-color);
            text-decoration: none;
            transition: all 0.2s ease;
            font-weight: 500;
            border-left: 3px solid transparent;
            position: relative;
            margin: 0;
        }

        .nav-link:hover {
            background: var(--light-color);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .nav-link.active {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .nav-link i {
            width: 20px;
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        /* Modern Main Content */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            background: var(--light-color);
            padding: 2rem;
        }

        /* Modern Cards */
        .card {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Modern Metrics Cards */
        .metric-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .metric-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--secondary-color);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .metric-change {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Color Variants for Metrics */
        .metric-primary { background: rgba(37, 99, 235, 0.1); color: var(--primary-color); }
        .metric-success { background: rgba(5, 150, 105, 0.1); color: var(--success-color); }
        .metric-warning { background: rgba(217, 119, 6, 0.1); color: var(--warning-color); }
        .metric-danger { background: rgba(220, 38, 38, 0.1); color: var(--danger-color); }

        .product-card {
            transition: all 0.2s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .delete-product-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            line-height: 1;
            z-index: 10;
            background: var(--danger-color);
            color: white;
            border: none;
            transition: all 0.2s ease;
        }

        .delete-product-btn:hover {
            background: #b91c1c;
            transform: scale(1.1);
        }

        /* Modern Tables */
        .table {
            background: white;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .table th {
            background: var(--light-color);
            border-bottom: 2px solid var(--border-color);
            padding: 1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .table tr:hover {
            background: var(--light-color);
        }

        /* Modern Buttons */
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-success { 
            background: var(--success-color); 
            color: white; 
            border: none;
        }

        .btn-warning { 
            background: var(--warning-color); 
            color: white; 
            border: none;
        }

        .btn-danger { 
            background: var(--danger-color); 
            color: white; 
            border: none;
        }

        .btn-secondary { 
            background: var(--secondary-color); 
            color: white; 
            border: none;
        }

        /* Advanced UI Enhancements */
        .dark-mode {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #94a3b8;
            --dark-color: #f1f5f9;
            --light-color: #1e293b;
            --border-color: #334155;
            background: #0f172a;
            color: #f1f5f9;
        }

        .dark-mode .sidebar {
            background: #1e293b;
            border-right: 1px solid #334155;
        }

        .dark-mode .nav-link {
            color: #cbd5e1;
        }

        .dark-mode .nav-link:hover {
            background: #334155;
        }

        .dark-mode .nav-link.active {
            background: var(--primary-color);
            color: white;
        }

        .dark-mode .card {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f1f5f9;
        }

        .dark-mode .table th {
            background: #334155;
            color: #f1f5f9;
        }

        .dark-mode .form-control {
            background: #334155;
            border: 1px solid #475569;
            color: #f1f5f9;
        }

        .dark-mode .form-control:focus {
            background: #475569;
            border-color: var(--primary-color);
            color: #f1f5f9;
        }

        /* Dark mode modal and additional component styles */
        .dark-mode .modal-content {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f1f5f9;
        }

        .dark-mode .modal-header {
            border-bottom: 1px solid #334155;
        }

        .dark-mode .modal-footer {
            border-top: 1px solid #334155;
        }

        .dark-mode .form-select {
            background: #334155;
            border: 1px solid #475569;
            color: #f1f5f9;
        }

        .dark-mode .alert {
            border: 1px solid #334155;
        }

        .dark-mode .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #93c5fd;
        }

        .dark-mode .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #86efac;
        }

        .dark-mode .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #fca5a5;
        }

        .dark-mode .text-muted {
            color: #94a3b8 !important;
        }

        .dark-mode .item-card {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f1f5f9;
        }

        .dark-mode .sponsor-slot {
            background: #334155;
            border: 2px dashed #475569 !important;
        }

        .dark-mode .sponsor-slot.drag-over {
            border-color: var(--primary-color) !important;
            background: rgba(59, 130, 246, 0.1);
        }

        .dark-mode .sponsored-item {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f1f5f9;
        }

        .dark-mode .btn-outline-secondary {
            border-color: #64748b;
            color: #64748b;
        }

        .dark-mode .btn-outline-secondary:hover {
            background: #64748b;
            border-color: #64748b;
            color: white;
        }

        .dark-mode .btn-outline-danger {
            border-color: #ef4444;
            color: #ef4444;
        }

        .dark-mode .btn-outline-danger:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .dark-mode .table-striped > tbody > tr:nth-of-type(odd) > td,
        .dark-mode .table-striped > tbody > tr:nth-of-type(odd) > th {
            background: #334155;
        }

        .dark-mode .table {
            color: #f1f5f9;
        }

        .dark-mode .badge {
            color: white;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* Search Enhancement */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
            pointer-events: none;
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        /* Success/Error Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--danger-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        /* Advanced Tables */
        .table-container {
            background: white;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .table-header {
            background: var(--primary-color);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-active {
            background: rgba(5, 150, 105, 0.1);
            color: var(--success-color);
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .status-pending {
            background: rgba(217, 119, 6, 0.1);
            color: var(--warning-color);
        }

        /* Modern Form Controls */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.2s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Quick Actions Panel */
        .quick-actions {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius-lg);
            margin-bottom: 2rem;
        }

        .quick-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem;
            transition: all 0.2s ease;
        }

        .quick-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: white;
            text-decoration: none;
        }

        /* Advanced Grid System */
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .admin-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--dark-color);
            margin: 0;
        }

        /* Responsive Design Improvements */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }

            .metric-card {
                margin-bottom: 1rem;
            }

            .admin-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* Animation Utilities */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        /* Mobile Header */
        .mobile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: white;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .mobile-menu-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--dark-color);
            cursor: pointer;
        }

        /* Page Header */
        .page-header {
            padding: 1.5rem 2rem 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .content-area {
            padding: 0 2rem 2rem;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
            color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Modern Form Elements */
        .form-select {
            background: var(--light-color);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Modern Badges */
        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: var(--border-radius);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        /* Modern Alerts */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-lg);
            border: 1px solid transparent;
            margin-bottom: 1rem;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.2);
            color: #1d4ed8;
        }

        .alert-success {
            background: rgba(5, 150, 105, 0.1);
            border-color: rgba(5, 150, 105, 0.2);
            color: var(--success-color);
        }

        .alert-danger {
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.2);
            color: var(--danger-color);
        }

        /* Modern Sponsorship Redesign */
        .sponsorship-container {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            background-attachment: fixed;
        }

        /* Gradient Button */
        .btn-gradient-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .btn-gradient-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* Modern Stat Cards */
        .stat-card {
            border-radius: 20px;
            padding: 30px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .bg-gradient-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bg-gradient-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .bg-gradient-info { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .bg-gradient-warning { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }

        .stat-icon {
            font-size: 3rem;
            opacity: 0.8;
            float: right;
            margin-top: -10px;
        }

        .stat-content h3 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0 5px 0;
        }

        .stat-content p {
            font-size: 1.1rem;
            margin: 0;
            opacity: 0.9;
        }

        .stat-trend {
            font-size: 0.9rem;
            margin-top: 8px;
            opacity: 0.8;
        }

        /* Modern Cards */
        .modern-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .modern-card:hover {
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card-header-modern {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .card-body-modern {
            padding: 25px;
        }

        /* Quick Actions Grid */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .quick-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .quick-action-btn i {
            font-size: 1.5rem;
        }

        /* Sponsorship Grid */
        .sponsorship-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            min-height: 400px;
        }

        .sponsor-item-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: move;
            border: 2px solid transparent;
        }

        .sponsor-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .sponsor-item-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        /* Loading States */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e9ecef;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .spinner-sm {
            width: 30px;
            height: 30px;
            border: 3px solid #e9ecef;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Performance List */
        .performance-list {
            min-height: 200px;
        }

        .performance-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .performance-item:last-child {
            border-bottom: none;
        }

        .performance-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        /* Enhanced Modal Styles */
        .modern-modal {
            border-radius: 20px;
            border: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            border-bottom: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.3rem;
        }

        .btn-close-modern {
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 10px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .btn-close-modern:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .modal-body-modern {
            padding: 30px;
        }

        .modal-footer-modern {
            padding: 20px 30px;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
            border-radius: 0 0 20px 20px;
        }

        /* Search Panel */
        .search-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .search-box input {
            padding-left: 45px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .modern-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .modern-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-header h6 {
            margin: 0;
            font-weight: 600;
            color: #495057;
        }

        /* Items Grid */
        .items-grid {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .items-grid::-webkit-scrollbar {
            width: 8px;
        }

        .items-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .items-grid::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .item-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .item-card.selected {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        /* Sponsor Slots Container */
        .sponsor-slots-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            min-height: 500px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .sponsor-slots-container.drag-over {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .empty-slots {
            text-align: center;
            color: #6c757d;
            padding: 60px 20px;
        }

        .empty-slots i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .slot-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .slot-number {
            background: rgba(255,255,255,0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sponsorship-container {
                padding: 15px;
            }
            
            .stat-card {
                margin-bottom: 20px;
            }
            
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
            
            .sponsorship-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-body-modern {
                padding: 20px;
            }
        }

        /* Loading Placeholder */
        .loading-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        /* Enhanced Sponsorship Modal Styles */
        .modal-items-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
        }

        .item-card {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .item-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-sm);
            transform: translateY(-2px);
        }

        .item-card.selected {
            border-color: var(--success-color);
            background: rgba(5, 150, 105, 0.1);
        }

        .item-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .sponsor-slots {
            min-height: 400px;
            background: var(--light-color);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
        }

        .sponsor-slot {
            min-height: 80px;
            border: 2px dashed var(--secondary-color);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            position: relative;
            transition: all 0.2s ease;
        }

        .sponsor-slot:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        .sponsor-slot.drag-over {
            border-color: var(--success-color);
            background: rgba(5, 150, 105, 0.1);
            transform: scale(1.02);
        }

        .sponsor-slot .slot-number {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .sponsor-slot .slot-content {
            padding-top: 10px;
        }

        .sponsored-item {
            background: var(--light-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .sponsored-item:hover {
            background: var(--border-color);
        }

        .remove-sponsor {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
        }

        /* Drag and Drop States */
        .draggable {
            cursor: move;
        }

        .draggable:active {
            cursor: grabbing;
        }

        .drop-zone {
            transition: all 0.2s ease;
        }

        .drop-zone.drag-over {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-color);
        }

        /* Loading spinner animation */
        .fa-spin {
            animation: fa-spin 1s infinite linear;
        }

        @keyframes fa-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .metric-card {
                padding: 1.5rem;
            }

            .card-body {
                padding: 1rem;
            }

            .sponsorship-container {
                padding: 1rem;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modern Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Custom Analytics Styles */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .activity-feed {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .college-stats {
            max-height: 250px;
            overflow-y: auto;
        }

        .stat-box {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .stat-box:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .card {
                background: #1e293b;
                border-color: #334155;
                color: #f1f5f9;
            }
        }
            overflow-y: auto;
        }

        .stat-box {
            transition: transform 0.2s;
        }

        .stat-box:hover {
            transform: translateY(-2px);
        }

        /* Chart containers */
        #userActivityChart, #usageDistributionChart, #userJourneyChart {
            max-width: 100%;
            height: auto;
        }

        /* Real-time indicator */
        .badge.pulse {
            animation: pulse 1.5s infinite;
        }

        /* Enhanced cards */
        .card-header {
            background-color: rgba(0,0,0,0.03);
            border-bottom: 1px solid rgba(0,0,0,0.125);
        }

        /* Progress bars */
        .progress {
            height: 10px;
        }

        .progress-bar {
            transition: width 0.6s ease;
        }

        /* Analytics specific styles */
        .analytics-container .card {
            margin-bottom: 1.5rem;
        }

        .analytics-container canvas {
            border-radius: 8px;
        }

        /* Mobile responsiveness for analytics */
        @media (max-width: 768px) {
            .analytics-container .col-md-3 {
                margin-bottom: 1rem;
            }
            
            .stat-box {
                margin-bottom: 1rem;
            }
        }
        
        /* Quick Actions Styles */
        .quick-actions {
            background: var(--light-color);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .quick-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            margin: 0.25rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .quick-action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            text-decoration: none;
        }

        .quick-action-btn i {
            font-size: 1rem;
        }

        /* Enhanced Stat Cards */
        .stat-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            height: 100%;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.users { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-icon.products { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-icon.rooms { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-icon.revenue { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        /* Dashboard Cards */
        .dashboard-card {
            border: none;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            box-shadow: var(--shadow-md);
        }

        .dashboard-card .card-header {
            background: var(--light-color);
            border-bottom: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            padding: 1.25rem 1.5rem;
        }

        .dashboard-card .card-body {
            padding: 1.5rem;
        }
        .sponsorship-container {
            padding: 20px;
        }
        
        .sponsorship-item {
            transition: all 0.3s ease;
            background-color: #f8f9fa !important;
        }
        
        .sponsorship-item:hover {
            background-color: #e9ecef !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .sponsor-slot {
            font-size: 1.2em;
            font-weight: bold;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .search-result-item {
            transition: all 0.2s ease;
        }
        
        .search-result-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        
        .sponsorship-sequence {
            min-height: 200px;
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-border text-primary mb-3" role="status"></div>
            <p class="mb-0">Loading...</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <form id="loginForm" class="login-form">
            <div class="login-logo">
                <h1>
                    <i class="fas fa-graduation-cap"></i>
                    StudX Admin
                </h1>
                <p class="subtitle">Management Dashboard</p>
            </div>
            <div class="mb-3">
                <input type="text" class="form-control" id="username" placeholder="Enter your username" required>
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
            </div>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rememberMe">
                <label class="form-check-label" for="rememberMe">Remember me</label>
            </div>
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-sign-in-alt me-2"></i>
                Sign In
            </button>
            <div id="errorMessage" class="error-message">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Invalid username or password
            </div>
        </form>
    </div>

    <!-- Main Content -->
    <div id="mainContent" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>
                    <i class="fas fa-graduation-cap"></i>
                    StudX Admin
                </h3>
                <p class="sidebar-subtitle">Management Dashboard</p>
            </div>
            <nav class="nav flex-column">
                <a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="#" class="nav-link" data-page="products">
                    <i class="fas fa-box"></i> Products
                </a>
                <a href="#" class="nav-link" data-page="users">
                    <i class="fas fa-users"></i> Users
                </a>
                <a href="#" class="nav-link" data-page="analytics">
                    <i class="fas fa-chart-line"></i> Analytics
                </a>
                <a href="#" class="nav-link" data-page="transactions">
                    <i class="fas fa-exchange-alt"></i> Transaction History
                </a>
                <a href="#" class="nav-link" data-page="sponsorship">
                    <i class="fas fa-star"></i> Sponsorship
                </a>
                <a href="#" class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>
                <a href="#" class="nav-link text-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Mobile Header -->
            <div class="mobile-header d-md-none">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h5 class="mb-0">StudX Admin</h5>
                <div></div> <!-- Spacer -->
            </div>

            <!-- Enhanced Page Header -->
            <div class="page-header">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 id="pageTitle" class="h3 mb-0">Dashboard</h1>
                        <p id="pageSubtitle" class="text-muted mb-0">Welcome to your admin dashboard</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-container d-none d-md-block" style="width: 300px;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="globalSearch" placeholder="Search anything...">
                        </div>
                        <button class="btn btn-primary ms-2" id="refreshData" title="Refresh Data">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Content Container -->
            <div id="content" class="content-area">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <script>
(async function() {
    // SUPABASE CONFIG - UPDATED WITH YOUR ACTUAL DATABASE CREDENTIALS
    const SUPABASE_URL = 'https://vdpmumstdxgftaaxeacx.supabase.co';
    const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkcG11bXN0ZHhnZnRhYXhlYWN4Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MTkwNjA4MiwiZXhwIjoyMDY3NDgyMDgyfQ.tdYV9te2jYq2ARdPiJi6mpkqfvg45YlfgZ2kXnhLVRs'; // Using service role for admin access
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY);

    // Check login status
    function checkLogin() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const rememberMe = localStorage.getItem('rememberMe');
        
        if (isLoggedIn === 'true' && rememberMe === 'true') {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            loadPage('dashboard');
            attachSidebarHandlers();
        } else {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
        }
    }

    // Handle login
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const rememberMe = document.getElementById('rememberMe').checked;

        // Simple demo login - accept any credentials
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        
        if (rememberMe) {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('rememberMe', 'true');
            localStorage.setItem('savedUsername', username);
        }
        
        loadPage('dashboard');
        attachSidebarHandlers();
    });

    // Attach sidebar navigation handlers
    function attachSidebarHandlers() {
        document.querySelectorAll('.nav-link[data-page]').forEach(link => {
            link.onclick = function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                loadPage(page);
            };
        });
        
        // Logout button
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.onclick = function(e) {
                e.preventDefault();
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('rememberMe');
                localStorage.removeItem('savedUsername');
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('loginContainer').style.display = 'block';
            };
        }
    }

    // Function to load page content
    function loadPage(page) {
        const contentDiv = document.getElementById('content');
        
        // Update active link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('data-page') === page) {
                link.classList.add('active');
            }
        });

        if (page === 'dashboard') {
            contentDiv.innerHTML = `
                <div class="dashboard-container">
                    <h2><i class="fas fa-tachometer-alt"></i> StudX Analytics Dashboard</h2>
                    
                    <!-- Quick Actions Panel -->
                    <div class="quick-actions">
                        <h5 class="mb-3"><i class="fas fa-bolt"></i> Quick Actions</h5>
                        <div class="d-flex flex-wrap">
                            <a href="#" class="quick-action-btn" onclick="loadPage('products')">
                                <i class="fas fa-plus"></i> Add Product
                            </a>
                            <a href="#" class="quick-action-btn" onclick="loadPage('users')">
                                <i class="fas fa-user-plus"></i> Add User
                            </a>
                            <a href="#" class="quick-action-btn" onclick="loadPage('sponsorship')">
                                <i class="fas fa-star"></i> Manage Sponsorship
                            </a>
                            <a href="#" class="quick-action-btn" onclick="showNotification('Export feature coming soon!', 'info')">
                                <i class="fas fa-download"></i> Export Data
                            </a>
                            <a href="#" class="quick-action-btn" onclick="loadPage('analytics')">
                                <i class="fas fa-chart-line"></i> View Analytics
                            </a>
                            <a href="#" class="quick-action-btn" onclick="loadPage('settings')">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                        </div>
                    </div>
                    
                    <!-- Real-time Stats Section -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h3 class="mb-1" id="totalUsers">-</h3>
                                        <p class="text-muted mb-0">Total Users</p>
                                        <small class="text-success" id="usersGrowth">
                                            Loading...
                                        </small>
                                    </div>
                                    <div class="stat-icon users">
                                        <i class="fas fa-users"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h3 class="mb-1" id="totalProducts">-</h3>
                                        <p class="text-muted mb-0">Products Listed</p>
                                        <small class="text-success" id="productsGrowth">
                                            Loading...
                                        </small>
                                    </div>
                                    <div class="stat-icon products">
                                        <i class="fas fa-shopping-bag"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h3 class="mb-1" id="totalRooms">-</h3>
                                        <p class="text-muted mb-0">Rooms Available</p>
                                        <small class="text-info" id="roomsGrowth">
                                            Loading...
                                        </small>
                                    </div>
                                    <div class="stat-icon rooms">
                                        <i class="fas fa-home"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h3 class="mb-1" id="totalRevenue">-</h3>
                                        <p class="text-muted mb-0">Total Revenue</p>
                                        <small class="text-success" id="revenueGrowth">
                                            Loading...
                                        </small>
                                    </div>
                                    <div class="stat-icon revenue">
                                        <i class="fas fa-rupee-sign"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="row mb-4">
                        <div class="col-lg-8 mb-3">
                            <div class="card dashboard-card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Revenue Trends</h5>
                                    <div class="dropdown">
                                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Last 30 Days
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#">Last 7 Days</a></li>
                                            <li><a class="dropdown-item" href="#">Last 30 Days</a></li>
                                            <li><a class="dropdown-item" href="#">Last 3 Months</a></li>
                                            <li><a class="dropdown-item" href="#">Last Year</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <canvas id="revenueChart" height="100"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mb-3">
                            <div class="card dashboard-card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Category Distribution</h5>
                                </div>
                                <div class="card-body d-flex align-items-center justify-content-center">
                                    <canvas id="categoryChart" width="200" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Analytics -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-dark text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-rupee-sign fa-2x me-3"></i>
                                        <div>
                                            <h5>Total Revenue</h5>
                                            <h3 id="totalRevenue">â‚¹0</h3>
                                            <small id="revenueGrowth">This month</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-purple text-white" style="background-color: #6f42c1 !important;">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-chart-line fa-2x me-3"></i>
                                        <div>
                                            <h5>Active Users</h5>
                                            <h3 id="activeUsers">-</h3>
                                            <small id="activeUsersTime">Last 7 days</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-gradient text-white" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4) !important;">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-star fa-2x me-3"></i>
                                        <div>
                                            <h5>Top College</h5>
                                            <h4 id="topCollege">-</h4>
                                            <small id="topCollegeCount">0 listings</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-gradient text-white" style="background: linear-gradient(45deg, #667eea, #764ba2) !important;">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-fire fa-2x me-3"></i>
                                        <div>
                                            <h5>Hot Category</h5>
                                            <h4 id="hotCategory">-</h4>
                                            <small id="hotCategoryCount">0 items</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Behavior Analytics -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-users"></i> User Activity Trends</h5>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button class="btn btn-outline-primary active" data-period="7">7D</button>
                                        <button class="btn btn-outline-primary" data-period="30">30D</button>
                                        <button class="btn btn-outline-primary" data-period="90">90D</button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <canvas id="userActivityChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-pie"></i> Platform Usage Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="usageDistributionChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Monitoring -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-chart-bar"></i> Real-time Analytics</h5>
                                    <span class="badge bg-success pulse" id="liveIndicator">LIVE</span>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center mb-3">
                                        <div class="col-md-4">
                                            <h3 id="onlineUsers" class="text-success">0</h3>
                                            <small class="text-muted">Online Now</small>
                                        </div>
                                        <div class="col-md-4">
                                            <h3 id="todayListings" class="text-primary">0</h3>
                                            <small class="text-muted">Today's Listings</small>
                                        </div>
                                        <div class="col-md-4">
                                            <h3 id="todaySignups" class="text-warning">0</h3>
                                            <small class="text-muted">New Signups</small>
                                        </div>
                                    </div>
                                    <div id="recentActivity" class="recent-activity">
                                        <h6>Recent Activity:</h6>
                                        <div id="activityFeed" class="activity-feed">
                                            <div class="activity-item">
                                                <i class="fas fa-spinner fa-spin"></i> Loading recent activity...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-map-marker-alt"></i> Geographic Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div id="collegeDistribution" class="college-stats">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-cog"></i> Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary" onclick="loadPage('products')">
                                            <i class="fas fa-box"></i> Manage Products
                                        </button>
                                        <button class="btn btn-outline-success" onclick="loadPage('users')">
                                            <i class="fas fa-users"></i> Manage Users
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="loadPage('analytics')">
                                            <i class="fas fa-chart-line"></i> Advanced Analytics
                                        </button>
                                        <button class="btn btn-outline-info" onclick="window.open('https://studxchange.vercel.app', '_blank')">
                                            <i class="fas fa-external-link-alt"></i> Open StudXchange Site
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="exportData()">
                                            <i class="fas fa-download"></i> Export Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-bell"></i> System Health</h5>
                                </div>
                                <div class="card-body">
                                    <div id="systemHealth">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Database Connection</span>
                                            <span class="badge bg-success" id="dbStatus">Connected</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Storage Usage</span>
                                            <span class="badge bg-warning" id="storageStatus">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>API Response Time</span>
                                            <span class="badge bg-success" id="apiStatus">Fast</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Active Sessions</span>
                                            <span class="badge bg-info" id="sessionStatus">-</span>
                                        </div>
                                        <div class="progress mt-3">
                                            <div class="progress-bar bg-success" role="progressbar" id="healthProgress" style="width: 85%">85% Healthy</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderDashboard();
        } else if (page === 'products') {
            contentDiv.innerHTML = `
                <div class="products-header mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <h2><i class="fas fa-box"></i> Products Management</h2>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex gap-2">
                                <select id="sortSelect" class="form-select" style="width: auto;">
                                    <option value="newest">Newest First</option>
                                    <option value="oldest">Oldest First</option>
                                    <option value="name">Name A-Z</option>
                                    <option value="type">Type</option>
                                </select>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-danger" id="bulkDeleteBtn" disabled>
                                        <i class="fas fa-trash"></i> Delete Selected
                                    </button>
                                    <button class="btn btn-outline-secondary" id="selectAllBtn">
                                        <i class="fas fa-check-square"></i> Select All
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='mb-3'>
                    <input type='text' id='productSearch' class='form-control' placeholder='Search products, rooms, notes...'>
                </div>
                <div id='productCards' class='row g-3'></div>
            `;
            renderProductsPage();
        } else if (page === 'users') {
            contentDiv.innerHTML = `<h2><i class="fas fa-users"></i> Users Management</h2><div id='usersTable'></div>`;
            renderUsersPage();
        } else if (page === 'analytics') {
            contentDiv.innerHTML = `
                <div class="analytics-container">
                    <h2><i class="fas fa-chart-line"></i> Advanced Analytics</h2>
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-bar"></i> User Behavior Analytics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <div class="stat-box text-center p-3 border rounded">
                                                <h4 id="avgSessionTime" class="text-primary">-</h4>
                                                <small class="text-muted">Avg Session Time</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="stat-box text-center p-3 border rounded">
                                                <h4 id="bounceRate" class="text-warning">-</h4>
                                                <small class="text-muted">Bounce Rate</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="stat-box text-center p-3 border rounded">
                                                <h4 id="conversionRate" class="text-success">-</h4>
                                                <small class="text-muted">Conversion Rate</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="stat-box text-center p-3 border rounded">
                                                <h4 id="retentionRate" class="text-info">-</h4>
                                                <small class="text-muted">7-Day Retention</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="advancedCharts">
                                        <canvas id="userJourneyChart" width="800" height="400"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderAdvancedAnalytics();
        } else if (page === 'transactions') {
            contentDiv.innerHTML = `
                <div class="transactions-container">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-exchange-alt"></i> Transaction History</h2>
                        <div class="d-flex gap-2">
                            <select id="transactionFilter" class="form-select" style="width: auto;">
                                <option value="all">All Transactions</option>
                                <option value="completed">Completed</option>
                                <option value="pending">Pending</option>
                                <option value="failed">Failed</option>
                            </select>
                            <input type="date" id="transactionDate" class="form-control" style="width: auto;">
                            <button class="btn btn-primary" onclick="exportTransactions()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <!-- Transaction Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-check-circle fa-2x me-3"></i>
                                        <div>
                                            <h5>Completed</h5>
                                            <h3 id="completedTransactions">-</h3>
                                            <small>Total transactions</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-clock fa-2x me-3"></i>
                                        <div>
                                            <h5>Pending</h5>
                                            <h3 id="pendingTransactions">-</h3>
                                            <small>Awaiting completion</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-rupee-sign fa-2x me-3"></i>
                                        <div>
                                            <h5>Total Volume</h5>
                                            <h3 id="totalVolume">â‚¹-</h3>
                                            <small>All transactions</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-percentage fa-2x me-3"></i>
                                        <div>
                                            <h5>Platform Revenue</h5>
                                            <h3 id="platformRevenue">â‚¹-</h3>
                                            <small>Total earnings</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Transactions Table -->
                    <div class="card">
                        <div class="card-header">
                            <h5>Recent Transactions</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Transaction ID</th>
                                            <th>Item</th>
                                            <th>Buyer</th>
                                            <th>Phone</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionsTableBody">
                                        <tr>
                                            <td colspan="8" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            loadTransactionHistory();
        } else if (page === 'sponsorship') {
            contentDiv.innerHTML = `
                <div class="sponsorship-container">
                    <!-- Header Section -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2 class="mb-1"><i class="fas fa-star text-warning"></i> Sponsorship Center</h2>
                            <p class="text-muted mb-0">Manage featured listings and boost visibility</p>
                        </div>
                        <button class="btn btn-gradient-primary btn-lg" onclick="openSponsorshipModal()">
                            <i class="fas fa-plus me-2"></i>Add New Sponsor
                        </button>
                    </div>

                    <!-- Quick Stats Cards -->
                    <div class="row g-4 mb-5">
                        <div class="col-lg-3 col-md-6">
                            <div class="stat-card bg-gradient-primary">
                                <div class="stat-icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="activeSponsorCount">-</h3>
                                    <p>Active Sponsors</p>
                                    <div class="stat-trend">
                                        <i class="fas fa-arrow-up"></i> 12% from last month
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="stat-card bg-gradient-success">
                                <div class="stat-icon">
                                    <i class="fas fa-rupee-sign"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="sponsorRevenue">â‚¹0</h3>
                                    <p>Revenue This Month</p>
                                    <div class="stat-trend">
                                        <i class="fas fa-arrow-up"></i> 8% increase
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="stat-card bg-gradient-info">
                                <div class="stat-icon">
                                    <i class="fas fa-eye"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="sponsorViews">-</h3>
                                    <p>Total Impressions</p>
                                    <div class="stat-trend">
                                        <i class="fas fa-arrow-up"></i> 15% boost
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="stat-card bg-gradient-warning">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="expiringSponsorships">-</h3>
                                    <p>Expiring Soon</p>
                                    <div class="stat-trend">
                                        <i class="fas fa-exclamation-triangle"></i> Needs attention
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="row g-4">
                        <!-- Sponsorship Sequence -->
                        <div class="col-lg-8">
                            <div class="modern-card">
                                <div class="card-header-modern">
                                    <div class="d-flex align-items-center">
                                        <div class="header-icon bg-primary">
                                            <i class="fas fa-list"></i>
                                        </div>
                                        <div>
                                            <h5 class="mb-1">Featured Sequence</h5>
                                            <p class="text-muted mb-0">Drag & drop to reorder priority</p>
                                        </div>
                                    </div>
                                    <div class="header-actions">
                                        <button class="btn btn-outline-primary btn-sm me-2" onclick="refreshSponsorshipSequence()">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" onclick="bulkAction('enable')">
                                            <i class="fas fa-play"></i> Enable All
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body-modern">
                                    <div id="sponsorshipSequence" class="sponsorship-grid">
                                        <div class="loading-state">
                                            <div class="spinner"></div>
                                            <p>Loading sponsorship sequence...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Control Panel -->
                        <div class="col-lg-4">
                            <div class="modern-card mb-4">
                                <div class="card-header-modern">
                                    <div class="d-flex align-items-center">
                                        <div class="header-icon bg-info">
                                            <i class="fas fa-control-panel"></i>
                                        </div>
                                        <div>
                                            <h5 class="mb-1">Quick Actions</h5>
                                            <p class="text-muted mb-0">Manage sponsors easily</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body-modern">
                                    <div class="quick-actions-grid">
                                        <button class="quick-action-btn" onclick="openSponsorshipModal()">
                                            <i class="fas fa-plus"></i>
                                            <span>Add Sponsor</span>
                                        </button>
                                        <button class="quick-action-btn" onclick="showAnalytics()">
                                            <i class="fas fa-chart-line"></i>
                                            <span>Analytics</span>
                                        </button>
                                        <button class="quick-action-btn" onclick="exportSponsors()">
                                            <i class="fas fa-download"></i>
                                            <span>Export Data</span>
                                        </button>
                                        <button class="quick-action-btn" onclick="showSettings()">
                                            <i class="fas fa-cog"></i>
                                            <span>Settings</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Insights -->
                            <div class="modern-card">
                                <div class="card-header-modern">
                                    <div class="d-flex align-items-center">
                                        <div class="header-icon bg-success">
                                            <i class="fas fa-chart-bar"></i>
                                        </div>
                                        <div>
                                            <h5 class="mb-1">Performance</h5>
                                            <p class="text-muted mb-0">Top performing sponsors</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body-modern">
                                    <div class="performance-list" id="topPerformers">
                                        <div class="loading-state">
                                            <div class="spinner-sm"></div>
                                            <p>Loading performance data...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Sponsorship Modal -->
                <div class="modal fade" id="sponsorshipModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content modern-modal">
                            <div class="modal-header-modern">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div>
                                        <h5 class="modal-title mb-1">Add New Sponsor</h5>
                                        <p class="text-muted mb-0">Select items to feature and boost visibility</p>
                                    </div>
                                </div>
                                <button type="button" class="btn-close-modern" data-bs-dismiss="modal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body-modern">
                                <div class="row g-4">
                                    <!-- Search & Filter Panel -->
                                    <div class="col-12">
                                        <div class="search-panel">
                                            <div class="row g-3">
                                                <div class="col-md-5">
                                                    <div class="search-box">
                                                        <i class="fas fa-search"></i>
                                                        <input type="text" id="modalItemSearch" placeholder="Search your listings...">
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <select id="modalItemType" class="form-select modern-select">
                                                        <option value="all">All Types</option>
                                                        <option value="product">Products</option>
                                                        <option value="note">Notes</option>
                                                        <option value="room">Rooms</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <select id="modalSortBy" class="form-select modern-select">
                                                        <option value="newest">Newest First</option>
                                                        <option value="price_high">Price: High to Low</option>
                                                        <option value="price_low">Price: Low to High</option>
                                                        <option value="views">Most Viewed</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <button class="btn btn-primary w-100" onclick="searchModalItems()">
                                                        <i class="fas fa-filter"></i> Filter
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Item Selection -->
                                    <div class="col-lg-8">
                                        <div class="section-header">
                                            <h6><i class="fas fa-list me-2"></i>Available Items</h6>
                                            <span class="badge bg-primary" id="itemCount">0 items</span>
                                        </div>
                                        <div id="modalItemsList" class="items-grid">
                                            <div class="loading-placeholder">
                                                <div class="spinner"></div>
                                                <p>Loading your listings...</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Sponsor Slots -->
                                    <div class="col-lg-4">
                                        <div class="section-header">
                                            <h6><i class="fas fa-sort-numeric-down me-2"></i>Featured Slots</h6>
                                            <span class="badge bg-success" id="selectedCount">0 selected</span>
                                        </div>
                                        <div id="sponsorSlots" class="sponsor-slots-container">
                                            <div class="empty-slots">
                                                <i class="fas fa-drag-and-drop"></i>
                                                <p>Drag items here to make them featured</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer-modern">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-2"></i>Cancel
                                </button>
                                <button type="button" class="btn btn-success" onclick="saveSponsorshipChanges()">
                                    <i class="fas fa-save me-2"></i>Save Featured Items
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderSponsorshipPage();
        } else if (page === 'settings') {
        } else if (page === 'settings') {
            contentDiv.innerHTML = `
                <div class='container py-4'>
                    <h2><i class="fas fa-cog"></i> Admin Settings</h2>
                    <div class='alert alert-info'>
                        <i class="fas fa-info-circle"></i> Settings functionality coming soon. This is a demo admin panel.
                    </div>
                </div>
            `;
        } else {
            contentDiv.innerHTML = `<div class="alert alert-danger">Unknown page: ${page}</div>`;
        }
    }

    // Dashboard: Load statistics with enhanced analytics
    async function renderDashboard() {
        try {
            const startTime = Date.now();
            
            console.log('ðŸ” Starting dashboard data fetch...');
            
            // Get current data with individual error handling
            const productsResult = await supabase.from('products').select('*', { count: 'exact' });
            console.log('ðŸ“¦ Products result:', productsResult);
            
            const notesResult = await supabase.from('notes').select('*', { count: 'exact' });
            console.log('ðŸ“ Notes result:', notesResult);
            
            const roomsResult = await supabase.from('rooms').select('*', { count: 'exact' });
            console.log('ðŸ  Rooms result:', roomsResult);
            
            const usersResult = await supabase.from('users').select('*', { count: 'exact' });
            console.log('ðŸ‘¥ Users result:', usersResult);
            
            const transactionsResult = await supabase.from('transactions').select('*').throwOnError(false);
            console.log('ðŸ’° Transactions result:', transactionsResult);
            
            const sponsorshipResult = await supabase.from('sponsorship_sequences').select('*', { count: 'exact' }).throwOnError(false);
            console.log('ðŸŒŸ Sponsorship result:', sponsorshipResult);
            
            // Extract data safely
            const products = productsResult.data || [];
            const productsCount = productsResult.count || 0;
            const notes = notesResult.data || [];
            const notesCount = notesResult.count || 0;
            const rooms = roomsResult.data || [];
            const roomsCount = roomsResult.count || 0;
            const users = usersResult.data || [];
            const usersCount = usersResult.count || 0;
            const transactions = transactionsResult.data || [];
            const sponsorships = sponsorshipResult.data || [];
            const sponsorshipsCount = sponsorshipResult.count || 0;
            
            console.log(`ðŸ“Š Final counts - Products: ${productsCount}, Notes: ${notesCount}, Rooms: ${roomsCount}, Users: ${usersCount}, Sponsorships: ${sponsorshipsCount}`);

            // Calculate API response time
            const responseTime = Date.now() - startTime;
            const apiStatusEl = document.getElementById('apiStatus');
            if (apiStatusEl) {
                apiStatusEl.textContent = responseTime < 500 ? 'Fast' : responseTime < 1000 ? 'Moderate' : 'Slow';
                apiStatusEl.className = `badge ${responseTime < 500 ? 'bg-success' : responseTime < 1000 ? 'bg-warning' : 'bg-danger'}`;
            }

            // Update basic counts with null checks
            const productsCountEl = document.getElementById('productsCount');
            const notesCountEl = document.getElementById('notesCount');
            const roomsCountEl = document.getElementById('roomsCount');
            const usersCountEl = document.getElementById('usersCount');
            
            if (productsCountEl) productsCountEl.textContent = productsCount || 0;
            if (notesCountEl) notesCountEl.textContent = notesCount || 0;
            if (roomsCountEl) roomsCountEl.textContent = roomsCount || 0;
            if (usersCountEl) usersCountEl.textContent = usersCount || 0;

            // Calculate growth metrics (comparing with last week)
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            const recentProducts = products.filter(p => new Date(p.created_at) > oneWeekAgo).length;
            const recentNotes = notes.filter(n => new Date(n.created_at) > oneWeekAgo).length;
            const recentRooms = rooms.filter(r => new Date(r.created_at) > oneWeekAgo).length;
            const recentUsers = users.filter(u => new Date(u.created_at) > oneWeekAgo).length;

            // Update old dashboard elements with null checks
            const productsGrowthEl = document.getElementById('productsGrowth');
            const notesGrowthEl = document.getElementById('notesGrowth');
            const roomsGrowthEl = document.getElementById('roomsGrowth');
            const usersGrowthEl = document.getElementById('usersGrowth');
            
            if (productsGrowthEl) productsGrowthEl.textContent = `+${recentProducts} this week`;
            if (notesGrowthEl) notesGrowthEl.textContent = `+${recentNotes} this week`;
            if (roomsGrowthEl) roomsGrowthEl.textContent = `+${recentRooms} this week`;
            if (usersGrowthEl) usersGrowthEl.textContent = `+${recentUsers} this week`;

            // Update basic counts in new stat cards with null checks
            const totalUsersEl = document.getElementById('totalUsers');
            const totalProductsEl = document.getElementById('totalProducts');
            const totalRoomsEl = document.getElementById('totalRooms');
            const totalRevenueEl = document.getElementById('totalRevenue');
            
            if (totalUsersEl) totalUsersEl.textContent = usersCount || 0;
            if (totalProductsEl) totalProductsEl.textContent = productsCount || 0;
            if (totalRoomsEl) totalRoomsEl.textContent = roomsCount || 0;

            // Calculate revenue (from transactions)
            const totalRevenue = transactions.reduce((sum, t) => sum + (parseFloat(t.platform_fee) || 0), 0);
            if (totalRevenueEl) totalRevenueEl.textContent = totalRevenue > 0 ? `â‚¹${totalRevenue.toLocaleString()}` : 'â‚¹0';

            // Calculate recent revenue for growth indicator
            const recentRevenue = transactions
                .filter(t => new Date(t.created_at) > oneWeekAgo)
                .reduce((sum, t) => sum + (parseFloat(t.platform_fee) || 0), 0);

            // Update growth indicators for new stat cards with null checks
            const usersGrowthNewEl = document.getElementById('usersGrowth');
            if (usersGrowthNewEl) {
                usersGrowthNewEl.innerHTML = recentUsers > 0 ? 
                    `<i class="fas fa-arrow-up"></i> +${recentUsers} this week` : 
                    '<i class="fas fa-minus"></i> No new users';
            }
            
            const productsGrowthNewEl = document.getElementById('productsGrowth');
            if (productsGrowthNewEl) {
                productsGrowthNewEl.innerHTML = recentProducts > 0 ? 
                    `<i class="fas fa-arrow-up"></i> +${recentProducts} this week` : 
                    '<i class="fas fa-minus"></i> No new products';
            }
            
            const roomsGrowthNewEl = document.getElementById('roomsGrowth');
            if (roomsGrowthNewEl) {
                roomsGrowthNewEl.innerHTML = recentRooms > 0 ? 
                    `<i class="fas fa-arrow-up"></i> +${recentRooms} this week` : 
                    '<i class="fas fa-minus"></i> No new rooms';
            }
            
            const revenueGrowthEl = document.getElementById('revenueGrowth');
            if (revenueGrowthEl) {
                revenueGrowthEl.innerHTML = recentRevenue > 0 ? 
                    `<i class="fas fa-arrow-up"></i> +â‚¹${recentRevenue.toLocaleString()} this week` : 
                    '<i class="fas fa-minus"></i> No revenue';
            }

            // Update old dashboard elements (for compatibility)
            if (document.getElementById('productsCount')) {
                document.getElementById('productsCount').textContent = productsCount || 0;
                document.getElementById('notesCount').textContent = notesCount || 0;
                document.getElementById('roomsCount').textContent = roomsCount || 0;
                document.getElementById('usersCount').textContent = usersCount || 0;
                
                // Update old growth indicators too
                if (document.getElementById('productsGrowth')) {
                    document.getElementById('productsGrowth').textContent = `+${recentProducts} this week`;
                    document.getElementById('notesGrowth').textContent = `+${recentNotes} this week`;
                    document.getElementById('roomsGrowth').textContent = `+${recentRooms} this week`;
                    document.getElementById('usersGrowth').textContent = `+${recentUsers} this week`;
                }
            }

            // Calculate active users (users with recent activity)
            const activeUsers = users.filter(u => {
                const lastActive = new Date(u.updated_at || u.created_at);
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                return lastActive > sevenDaysAgo;
            }).length;
            if (document.getElementById('activeUsers')) {
                document.getElementById('activeUsers').textContent = activeUsers;
            }

            // Find top college
            const collegeStats = {};
            [...products, ...notes, ...rooms].forEach(item => {
                if (item.college) {
                    collegeStats[item.college] = (collegeStats[item.college] || 0) + 1;
                }
            });
            const topCollege = Object.entries(collegeStats).sort((a, b) => b[1] - a[1])[0];
            if (topCollege && document.getElementById('topCollege')) {
                document.getElementById('topCollege').textContent = topCollege[0];
                document.getElementById('topCollegeCount').textContent = `${topCollege[1]} listings`;
            }

            // Find hot category
            const categoryStats = {};
            [...products, ...notes, ...rooms].forEach(item => {
                if (item.category) {
                    categoryStats[item.category] = (categoryStats[item.category] || 0) + 1;
                }
            });
            const hotCategory = Object.entries(categoryStats).sort((a, b) => b[1] - a[1])[0];
            if (hotCategory && document.getElementById('hotCategory')) {
                document.getElementById('hotCategory').textContent = hotCategory[0];
                document.getElementById('hotCategoryCount').textContent = `${hotCategory[1]} items`;
            }

            // Update real-time stats
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const todayListings = [...products, ...notes, ...rooms].filter(item => 
                new Date(item.created_at) >= today
            ).length;
            
            const todaySignups = users.filter(user => 
                new Date(user.created_at) >= today
            ).length;

            document.getElementById('todayListings').textContent = todayListings;
            document.getElementById('todaySignups').textContent = todaySignups;
            document.getElementById('onlineUsers').textContent = Math.floor(Math.random() * 50) + 10; // Simulated

            // Update activity feed
            const recentActivity = [...products, ...notes, ...rooms, ...users]
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                .slice(0, 5);

            const activityHTML = recentActivity.map(item => {
                const type = item.title ? (item.academic_year ? 'note' : item.room_type ? 'room' : 'product') : 'user';
                const icon = type === 'note' ? 'fas fa-sticky-note text-success' : 
                           type === 'room' ? 'fas fa-home text-warning' : 
                           type === 'product' ? 'fas fa-box text-primary' : 'fas fa-user text-info';
                const action = type === 'user' ? 'joined' : 'posted';
                const timeAgo = getRelativeTime(item.created_at);
                
                return `
                    <div class="activity-item d-flex align-items-center mb-2">
                        <i class="${icon} me-2"></i>
                        <small>
                            <strong>${item.name || item.title || 'Someone'}</strong> ${action} ${type === 'user' ? '' : 'a ' + type}
                            <span class="text-muted">${timeAgo}</span>
                        </small>
                    </div>
                `;
            }).join('');

            document.getElementById('activityFeed').innerHTML = activityHTML || '<div class="activity-item"><i class="fas fa-info-circle text-muted"></i> No recent activity</div>';

            // Update college distribution
            const collegeHTML = Object.entries(collegeStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([college, count]) => {
                    const percentage = Math.round((count / (productsCount + notesCount + roomsCount)) * 100);
                    return `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small>${college}</small>
                            <span class="badge bg-primary">${count} (${percentage}%)</span>
                        </div>
                    `;
                }).join('');

            document.getElementById('collegeDistribution').innerHTML = collegeHTML || '<div class="text-muted text-center">No college data</div>';

            // Update storage status
            const estimatedStorage = Math.round((productsCount + notesCount + roomsCount + usersCount) * 0.001); // Rough estimate
            document.getElementById('storageStatus').textContent = `${estimatedStorage}MB used`;
            document.getElementById('storageStatus').className = `badge ${estimatedStorage < 400 ? 'bg-success' : estimatedStorage < 450 ? 'bg-warning' : 'bg-danger'}`;

            // Update session status
            document.getElementById('sessionStatus').textContent = Math.floor(Math.random() * 20) + 5; // Simulated

            // Live indicator animation
            setInterval(() => {
                const indicator = document.getElementById('liveIndicator');
                if (indicator) {
                    indicator.style.opacity = indicator.style.opacity === '0.5' ? '1' : '0.5';
                }
            }, 1000);

        } catch (error) {
            console.error('Error loading dashboard:', error);
            document.getElementById('dbStatus').textContent = 'Error';
            document.getElementById('dbStatus').className = 'badge bg-danger';
        }
        
        // Initialize charts after data is loaded
        setTimeout(initializeCharts, 100);
    }

    // Chart initialization function
    async function initializeCharts() {
        try {
            // Fetch real data for charts
            const [
                { data: products = [] },
                { data: notes = [] },
                { data: rooms = [] },
                { data: transactions = [] }
            ] = await Promise.all([
                supabase.from('products').select('*'),
                supabase.from('notes').select('*'),
                supabase.from('rooms').select('*'),
                supabase.from('transactions').select('*').throwOnError(false)
            ]);

            // Calculate real revenue data for last 6 months
            const monthlyRevenue = calculateMonthlyRevenue(transactions);
            const categoryData = calculateCategoryDistribution([...products, ...notes, ...rooms]);
            const weeklyActivity = calculateWeeklyActivity([...products, ...notes, ...rooms]);

            // Revenue Chart with real data
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: monthlyRevenue.labels,
                        datasets: [{
                            label: 'Revenue (â‚¹)',
                            data: monthlyRevenue.data,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Category Distribution Chart with real data
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categoryData.labels,
                        datasets: [{
                            data: categoryData.data,
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            }

            // User Activity Chart with real data
            const userActivityCtx = document.getElementById('userActivityChart');
            if (userActivityCtx) {
                new Chart(userActivityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'New Listings',
                            data: weeklyActivity,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Usage Distribution Chart with real data
            const usageCtx = document.getElementById('usageDistributionChart');
            if (usageCtx) {
                const usageData = [products.length, notes.length, rooms.length];
                new Chart(usageCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Products', 'Notes', 'Rooms'],
                        datasets: [{
                            data: usageData,
                            backgroundColor: [
                                '#FF6384',
                                '#36A2EB',
                                '#FFCE56'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }
        } catch (error) {
            console.error('Error initializing charts:', error);
            // Fallback to empty charts if data fetch fails
            initializeEmptyCharts();
        }
    }

    // Helper functions for real data calculations
    function calculateMonthlyRevenue(transactions) {
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
        const now = new Date();
        const labels = [];
        const data = [];
        
        for (let i = 5; i >= 0; i--) {
            const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
            labels.push(months[month.getMonth()]);
            
            const monthRevenue = transactions
                .filter(t => {
                    const tDate = new Date(t.created_at);
                    return tDate.getMonth() === month.getMonth() && 
                           tDate.getFullYear() === month.getFullYear();
                })
                .reduce((sum, t) => sum + (parseFloat(t.platform_fee) || 0), 0);
            
            data.push(monthRevenue);
        }
        
        return { labels, data };
    }

    function calculateCategoryDistribution(items) {
        const categories = {};
        items.forEach(item => {
            if (item.category) {
                categories[item.category] = (categories[item.category] || 0) + 1;
            }
        });
        
        const sorted = Object.entries(categories)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10); // Top 10 categories
        
        return {
            labels: sorted.map(([cat]) => cat),
            data: sorted.map(([, count]) => count)
        };
    }

    function calculateWeeklyActivity(items) {
        const weekDays = [1, 2, 3, 4, 5, 6, 0]; // Mon-Sun
        const activity = new Array(7).fill(0);
        
        items.forEach(item => {
            const day = new Date(item.created_at).getDay();
            const index = weekDays.indexOf(day);
            if (index !== -1) activity[index]++;
        });
        
        return activity;
    }

    function initializeEmptyCharts() {
        // Initialize charts with no data message
        ['revenueChart', 'categoryChart', 'userActivityChart', 'usageDistributionChart'].forEach(chartId => {
            const ctx = document.getElementById(chartId);
            if (ctx) {
                const parentDiv = ctx.parentElement;
                parentDiv.innerHTML = '<div class="text-center py-4 text-muted"><i class="fas fa-chart-line fa-2x mb-2"></i><br>No data available</div>';
            }
        });
    }

    // Advanced Analytics Function
    async function renderAdvancedAnalytics() {
        try {
            // Fetch data for advanced analytics
            const [
                { data: users = [] },
                { data: products = [] },
                { data: notes = [] },
                { data: rooms = [] },
                { data: transactions = [] }
            ] = await Promise.all([
                supabase.from('users').select('*'),
                supabase.from('products').select('*'),
                supabase.from('notes').select('*'),
                supabase.from('rooms').select('*'),
                supabase.from('transactions').select('*').throwOnError(false)
            ]);

            // Calculate metrics
            const totalUsers = users.length;
            const totalItems = products.length + notes.length + rooms.length;
            const totalTransactions = transactions.length;

            // Simulated advanced metrics (in real app, these would come from tracking)
            document.getElementById('avgSessionTime').textContent = '4m 32s';
            document.getElementById('bounceRate').textContent = '23%';
            document.getElementById('conversionRate').textContent = totalTransactions > 0 ? `${Math.round((totalTransactions / totalUsers) * 100)}%` : '0%';
            document.getElementById('retentionRate').textContent = '78%';

        } catch (error) {
            console.error('Error loading advanced analytics:', error);
        }
    }

    // Helper function for relative time
    function getRelativeTime(dateString) {
        const now = new Date();
        const past = new Date(dateString);
        const diffInSeconds = Math.floor((now - past) / 1000);
        
        if (diffInSeconds < 60) return 'just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
        if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)}d ago`;
        return `${Math.floor(diffInSeconds / 2592000)}mo ago`;
    }

    // Export data function
    async function exportData() {
        try {
            const exportBtn = event.target;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
            exportBtn.disabled = true;

            const [
                { data: users = [] },
                { data: products = [] },
                { data: notes = [] },
                { data: rooms = [] },
                { data: transactions = [] }
            ] = await Promise.all([
                supabase.from('users').select('*'),
                supabase.from('products').select('*'),
                supabase.from('notes').select('*'),
                supabase.from('rooms').select('*'),
                supabase.from('transactions').select('*').throwOnError(false)
            ]);

            const exportData = {
                exportDate: new Date().toISOString(),
                summary: {
                    users: users.length,
                    products: products.length,
                    notes: notes.length,
                    rooms: rooms.length,
                    transactions: transactions.length
                },
                data: {
                    users,
                    products,
                    notes,
                    rooms,
                    transactions
                }
            };

            // Create and download file
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `studx-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            exportBtn.innerHTML = '<i class="fas fa-download"></i> Export Data';
            exportBtn.disabled = false;
            alert('Data exported successfully!');

        } catch (error) {
            console.error('Export failed:', error);
            alert('Export failed: ' + error.message);
        }
    }

    // Products Page: Fetch all items and render as cards
    async function renderProductsPage() {
        let allItems = [];
        let selectedItems = new Set();
        
        try {
            const [{ data: products = [] } = {}, { data: notes = [] } = {}, { data: rooms = [] } = {}] = await Promise.all([
                supabase.from('products').select('*').order('created_at', { ascending: false }).throwOnError(false),
                supabase.from('notes').select('*').order('created_at', { ascending: false }).throwOnError(false),
                supabase.from('rooms').select('*').order('created_at', { ascending: false }).throwOnError(false)
            ]);
            
            products.forEach(p => p._type = 'product');
            notes.forEach(n => n._type = 'note');
            rooms.forEach(r => r._type = 'room');
            allItems = [...products, ...notes, ...rooms];
            
            // Sort all items by created_at in descending order (newest first)
            allItems.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
        } catch (err) {
            document.getElementById('productCards').innerHTML = `<div class='alert alert-danger'>Failed to load items: ${err.message}</div>`;
            return;
        }

        function updateBulkButtons() {
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            const selectAllBtn = document.getElementById('selectAllBtn');
            
            if (bulkDeleteBtn) {
                bulkDeleteBtn.disabled = selectedItems.size === 0;
                bulkDeleteBtn.innerHTML = `<i class="fas fa-trash"></i> Delete Selected (${selectedItems.size})`;
            }
            
            if (selectAllBtn) {
                const allSelected = selectedItems.size === allItems.length;
                selectAllBtn.innerHTML = allSelected ? 
                    '<i class="fas fa-square"></i> Deselect All' : 
                    '<i class="fas fa-check-square"></i> Select All';
            }
        }

        function renderCards(filter = '', sortBy = 'newest') {
            let filtered = allItems.filter(item => {
                const search = filter.toLowerCase();
                return Object.values(item).join(' ').toLowerCase().includes(search);
            });
            
            // Sort filtered items based on sortBy parameter
            switch(sortBy) {
                case 'newest':
                    filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
                case 'oldest':
                    filtered.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
                    break;
                case 'name':
                    filtered.sort((a, b) => {
                        const nameA = (a.title || a.name || '').toLowerCase();
                        const nameB = (b.title || b.name || '').toLowerCase();
                        return nameA.localeCompare(nameB);
                    });
                    break;
                case 'type':
                    filtered.sort((a, b) => a._type.localeCompare(b._type));
                    break;
            }
            
            if (!filtered.length) {
                document.getElementById('productCards').innerHTML = `<div class='alert alert-info'>No items found.</div>`;
                return;
            }
            
            document.getElementById('productCards').innerHTML = filtered.map(item => {
                let imgSrc = item.image || item.image_url || item.img || (item.images && Array.isArray(item.images) && item.images.length > 0 ? item.images[0] : '');
                let imgTag = imgSrc ? `<img src='${imgSrc}' alt='Image' class='card-img-top' style='object-fit:cover;height:180px;'>` : `<div style='height:180px;background:#eee;display:flex;align-items:center;justify-content:center;color:#aaa;'>No Image</div>`;
                const isSelected = selectedItems.has(item.id);
                
                return `
                <div class='col-md-4'>
                    <div class='card product-card h-100 position-relative ${isSelected ? 'border-primary' : ''}' style='cursor:pointer;' data-id='${item.id}' data-type='${item._type}'>
                        <div class="form-check position-absolute" style="top: 10px; left: 10px; z-index: 10;">
                            <input class="form-check-input item-checkbox" type="checkbox" data-id="${item.id}" ${isSelected ? 'checked' : ''}>
                        </div>
                        <button class='btn btn-sm btn-danger delete-product-btn' data-id='${item.id}' data-type='${item._type}' title='Delete'>&times;</button>
                        ${imgTag}
                        <div class='card-body'>
                            <h5 class='card-title'>${item.title || item.name || '(no title)'}</h5>
                            <p class='card-text'><b>Type:</b> <span class="badge bg-secondary">${item._type}</span></p>
                            <p class='card-text'><b>ID:</b> ${item.id}</p>
                            <p class='card-text'><b>Created:</b> ${new Date(item.created_at).toLocaleDateString()} <small class="text-muted">(${getRelativeTime(item.created_at)})</small></p>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            // Add checkbox handlers
            document.querySelectorAll('.item-checkbox').forEach(checkbox => {
                checkbox.onclick = (e) => {
                    e.stopPropagation();
                    const id = checkbox.getAttribute('data-id');
                    if (checkbox.checked) {
                        selectedItems.add(id);
                    } else {
                        selectedItems.delete(id);
                    }
                    updateBulkButtons();
                    renderCards(filter);
                };
            });
            
            // Add individual delete handlers
            document.querySelectorAll('.delete-product-btn').forEach(btn => {
                btn.onclick = async (e) => {
                    e.stopPropagation();
                    if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) return;
                    
                    const id = btn.getAttribute('data-id');
                    const type = btn.getAttribute('data-type');
                    let table = type === 'note' ? 'notes' : (type === 'room' ? 'rooms' : 'products');
                    
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    btn.disabled = true;
                    
                    try {
                        const { error } = await supabase.from(table).delete().eq('id', id);
                        if (error) {
                            alert('Failed to delete: ' + error.message);
                            btn.innerHTML = '&times;';
                            btn.disabled = false;
                            return;
                        }
                        
                        const itemIndex = allItems.findIndex(item => item.id === id && item._type === type);
                        if (itemIndex !== -1) {
                            allItems.splice(itemIndex, 1);
                        }
                        
                        selectedItems.delete(id);
                        const searchValue = document.getElementById('productSearch')?.value || '';
                        const sortValue = document.getElementById('sortSelect')?.value || 'newest';
                        renderCards(searchValue, sortValue);
                        alert('Item deleted successfully!');
                    } catch (err) {
                        alert('Error deleting item: ' + err.message);
                        btn.innerHTML = '&times;';
                        btn.disabled = false;
                    }
                };
            });
            
            updateBulkButtons();
        }

        // Helper function to get relative time
        function getRelativeTime(dateString) {
            const now = new Date();
            const past = new Date(dateString);
            const diffInSeconds = Math.floor((now - past) / 1000);
            
            if (diffInSeconds < 60) return 'just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            return `${Math.floor(diffInSeconds / 2592000)}mo ago`;
        }

        renderCards();
        
        // Setup sorting
        const sortSelect = document.getElementById('sortSelect');
        if (sortSelect) {
            sortSelect.addEventListener('change', (e) => {
                const searchValue = document.getElementById('productSearch')?.value || '';
                renderCards(searchValue, e.target.value);
            });
        }
        
        // Setup bulk operations
        const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
        const selectAllBtn = document.getElementById('selectAllBtn');
        
        if (bulkDeleteBtn) {
            bulkDeleteBtn.onclick = async () => {
                if (selectedItems.size === 0) return;
                
                if (!confirm(`Are you sure you want to delete ${selectedItems.size} items? This action cannot be undone.`)) return;
                
                bulkDeleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
                bulkDeleteBtn.disabled = true;
                
                try {
                    const promises = [];
                    selectedItems.forEach(id => {
                        const item = allItems.find(i => i.id === id);
                        if (item) {
                            const table = item._type === 'note' ? 'notes' : (item._type === 'room' ? 'rooms' : 'products');
                            promises.push(supabase.from(table).delete().eq('id', id));
                        }
                    });
                    
                    await Promise.all(promises);
                    
                    allItems = allItems.filter(item => !selectedItems.has(item.id));
                    selectedItems.clear();
                    
                    const searchValue = document.getElementById('productSearch')?.value || '';
                    const sortValue = document.getElementById('sortSelect')?.value || 'newest';
                    renderCards(searchValue, sortValue);
                    alert('Items deleted successfully!');
                } catch (error) {
                    alert('Error deleting items: ' + error.message);
                }
                
                bulkDeleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete Selected';
                bulkDeleteBtn.disabled = true;
            };
        }
        
        if (selectAllBtn) {
            selectAllBtn.onclick = () => {
                const allSelected = selectedItems.size === allItems.length;
                if (allSelected) {
                    selectedItems.clear();
                } else {
                    allItems.forEach(item => selectedItems.add(item.id));
                }
                updateBulkButtons();
                const searchValue = document.getElementById('productSearch')?.value || '';
                const sortValue = document.getElementById('sortSelect')?.value || 'newest';
                renderCards(searchValue, sortValue);
            };
        }
        
        // Search functionality
        const searchInput = document.getElementById('productSearch');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const sortValue = document.getElementById('sortSelect')?.value || 'newest';
                renderCards(e.target.value, sortValue);
            });
        }
    }

    // Users Page: Fetch all users from users table
    async function renderUsersPage() {
        try {
            const { data: users = [], error } = await supabase.from('users').select('*');
            if (error) throw error;
            
            if (!users.length) {
                document.getElementById('usersTable').innerHTML = `<div class='alert alert-info'>No users found.</div>`;
                return;
            }
            
            document.getElementById('usersTable').innerHTML = `
                <div class='table-responsive'>
                    <table class='table table-striped'>
                        <thead>
                            <tr>
                                ${Object.keys(users[0]).map(k => `<th>${k}</th>`).join('')}
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(u => `
                                <tr id='user-row-${u.id}'>
                                    ${Object.values(u).map(v => `<td>${v || 'N/A'}</td>`).join('')}
                                    <td>
                                        <button class='btn btn-sm btn-danger delete-user-btn' data-id='${u.id}'>
                                            Delete
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            // Add delete handlers
            document.querySelectorAll('.delete-user-btn').forEach(btn => {
                btn.onclick = async () => {
                    if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) return;
                    
                    const id = btn.getAttribute('data-id');
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    btn.disabled = true;
                    
                    try {
                        const { error } = await supabase.from('users').delete().eq('id', id);
                        if (error) {
                            alert('Failed to delete user: ' + error.message);
                            btn.innerHTML = 'Delete';
                            btn.disabled = false;
                            return;
                        }
                        
                        const row = document.getElementById(`user-row-${id}`);
                        if (row) {
                            row.remove();
                        }
                        
                        alert('User deleted successfully!');
                        
                        const tableBody = document.querySelector('#usersTable tbody');
                        if (tableBody && tableBody.children.length === 0) {
                            document.getElementById('usersTable').innerHTML = `<div class='alert alert-info'>No users found.</div>`;
                        }
                    } catch (err) {
                        alert('Error deleting user: ' + err.message);
                        btn.innerHTML = 'Delete';
                        btn.disabled = false;
                    }
                };
            });
        } catch (err) {
            document.getElementById('usersTable').innerHTML = `<div class='alert alert-danger'>Failed to load users: ${err.message}</div>`;
        }
    }

    // Transaction History Functions
    async function loadTransactionHistory() {
        try {
            console.log('ðŸ“Š Loading transaction history...');
            
            // Load all transactions first
            const { data: transactions, error } = await supabase
                .from('transactions')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(100);

            if (error) throw error;

            // For each transaction, fetch the related item and user details separately
            const enrichedTransactions = await Promise.all(transactions.map(async (transaction) => {
                let item = null;
                let buyer = null;
                let seller = null;

                // Fetch item details based on item_type
                try {
                    if (transaction.item_type === 'note') {
                        const { data: noteData } = await supabase
                            .from('notes')
                            .select('id, title')
                            .eq('id', transaction.listing_id)
                            .single();
                        item = noteData ? { ...noteData, type: 'note' } : null;
                    } else if (transaction.item_type === 'room') {
                        const { data: roomData } = await supabase
                            .from('rooms')
                            .select('id, hostel_name, room_type')
                            .eq('id', transaction.listing_id)
                            .single();
                        item = roomData ? { ...roomData, type: 'room', title: `${roomData.hostel_name} - ${roomData.room_type}` } : null;
                    } else {
                        const { data: productData } = await supabase
                            .from('products')
                            .select('id, title, name')
                            .eq('id', transaction.listing_id)
                            .single();
                        item = productData ? { ...productData, type: 'product', title: productData.title || productData.name } : null;
                    }
                } catch (itemError) {
                    console.error('Error fetching item:', itemError);
                }

                // Fetch buyer details
                try {
                    const { data: buyerData } = await supabase
                        .from('users')
                        .select('id, full_name, phone, email')
                        .eq('id', transaction.buyer_id)
                        .single();
                    buyer = buyerData;
                } catch (buyerError) {
                    console.error('Error fetching buyer:', buyerError);
                }

                // Fetch seller details
                try {
                    const { data: sellerData } = await supabase
                        .from('users')
                        .select('id, full_name, phone, email')
                        .eq('id', transaction.seller_id)
                        .single();
                    seller = sellerData;
                } catch (sellerError) {
                    console.error('Error fetching seller:', sellerError);
                }

                return {
                    ...transaction,
                    item,
                    buyer,
                    seller
                };
            }));

            // Update summary cards
            const completed = enrichedTransactions.filter(t => t.status === 'completed');
            const pending = enrichedTransactions.filter(t => t.status === 'pending');
            const totalVolume = enrichedTransactions
                .filter(t => t.status === 'completed')
                .reduce((sum, t) => sum + t.amount, 0);
            const platformRevenue = enrichedTransactions
                .filter(t => t.status === 'completed')
                .reduce((sum, t) => sum + (t.amount * 0.05), 0);

            // Update UI
            const safeUpdate = (id, value) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            };

            safeUpdate('completedTransactions', completed.length);
            safeUpdate('pendingTransactions', pending.length);
            safeUpdate('totalVolume', `â‚¹${totalVolume.toLocaleString()}`);
            safeUpdate('platformRevenue', `â‚¹${Math.round(platformRevenue).toLocaleString()}`);

            // Populate table
            const tbody = document.getElementById('transactionsTableBody');
            if (!tbody) return;

            if (enrichedTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No transactions found</td></tr>';
                return;
            }

            tbody.innerHTML = enrichedTransactions.map(transaction => {
                // Get item name based on type
                let itemName = 'Unknown Item';
                if (transaction.item) {
                    itemName = transaction.item.title || transaction.item.name || 'Untitled Item';
                }

                const buyerName = transaction.buyer?.full_name || 'Unknown Buyer';
                const buyerPhone = transaction.buyer?.phone || 'N/A';
                const statusColor = {
                    'completed': 'success',
                    'pending': 'warning',
                    'failed': 'danger'
                }[transaction.status] || 'secondary';

                const date = new Date(transaction.created_at).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <tr>
                        <td><code>${transaction.id.substring(0, 8)}...</code></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-info me-2">${transaction.listing_type}</span>
                                <span title="${itemName}">${itemName.length > 30 ? itemName.substring(0, 30) + '...' : itemName}</span>
                            </div>
                        </td>
                        <td>${buyerName}</td>
                        <td><a href="tel:${buyerPhone}" class="text-decoration-none">${buyerPhone}</a></td>
                        <td><strong>â‚¹${transaction.amount.toLocaleString()}</strong></td>
                        <td><span class="badge bg-${statusColor}">${transaction.status}</span></td>
                        <td><small>${date}</small></td>
                        <td>
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewTransactionDetails('${transaction.id}')" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${transaction.status === 'pending' ? `
                                    <button class="btn btn-sm btn-outline-success" onclick="markTransactionCompleted('${transaction.id}')" title="Mark Completed">
                                        <i class="fas fa-check"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            // Setup filters
            setupTransactionFilters(enrichedTransactions);

        } catch (error) {
            console.error('Error loading transaction history:', error);
            const tbody = document.getElementById('transactionsTableBody');
            if (tbody) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading transactions</td></tr>';
            }
        }
    }

    // Setup transaction filters
    function setupTransactionFilters(allTransactions) {
        const filterSelect = document.getElementById('transactionFilter');
        const dateInput = document.getElementById('transactionDate');
        
        if (filterSelect) {
            filterSelect.addEventListener('change', () => filterTransactions(allTransactions));
        }
        
        if (dateInput) {
            dateInput.addEventListener('change', () => filterTransactions(allTransactions));
        }
    }

    // Filter transactions
    function filterTransactions(allTransactions) {
        const filter = document.getElementById('transactionFilter')?.value || 'all';
        const date = document.getElementById('transactionDate')?.value;
        
        let filtered = allTransactions;
        
        // Filter by status
        if (filter !== 'all') {
            filtered = filtered.filter(t => t.status === filter);
        }
        
        // Filter by date
        if (date) {
            const filterDate = new Date(date).toDateString();
            filtered = filtered.filter(t => new Date(t.created_at).toDateString() === filterDate);
        }
        
        // Update table with filtered results
        updateTransactionTable(filtered);
    }

    // Update transaction table
    function updateTransactionTable(transactions) {
        const tbody = document.getElementById('transactionsTableBody');
        if (!tbody) return;
        
        if (transactions.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No transactions match the selected filters</td></tr>';
            return;
        }
        
        // Reuse the same table generation logic...
        // (Implementation same as in loadTransactionHistory)
    }

    // View transaction details
    function viewTransactionDetails(transactionId) {
        showNotification(`Viewing details for transaction ${transactionId.substring(0, 8)}...`, 'info');
        // Implementation for viewing transaction details modal
    }

    // Mark transaction as completed
    async function markTransactionCompleted(transactionId) {
        try {
            const { error } = await supabase
                .from('transactions')
                .update({ status: 'completed' })
                .eq('id', transactionId);
                
            if (error) throw error;
            
            showNotification('Transaction marked as completed', 'success');
            loadTransactionHistory(); // Reload the table
        } catch (error) {
            console.error('Error updating transaction:', error);
            showNotification('Error updating transaction', 'error');
        }
    }

    // Export transactions
    function exportTransactions() {
        showNotification('Export functionality coming soon!', 'info');
        // Implementation for CSV/Excel export
    }

    // Enhanced Sponsorship Management Functions
    async function renderSponsorshipPage() {
        try {
            console.log('ðŸŒŸ Loading modern sponsorship interface...');
            
            // Load sponsorship sequence with modern design
            await loadModernSponsorshipSequence();
            
            // Load sponsorship metrics
            await loadSponsorshipMetrics();
            
            // Load performance insights
            await loadPerformanceInsights();
            
            console.log('âœ… Modern sponsorship interface loaded successfully!');
            
        } catch (error) {
            console.error('Error loading sponsorship page:', error);
            document.getElementById('sponsorshipSequence').innerHTML = 
                '<div class="loading-state"><i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem; margin-bottom: 20px;"></i><p class="text-danger">Error loading sponsorship data</p></div>';
        }
    }

    // Load modern sponsorship sequence
    async function loadModernSponsorshipSequence() {
        const container = document.getElementById('sponsorshipSequence');
        
        try {
            // Show loading state
            container.innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading featured items...</p>
                </div>
            `;

            // Fetch sponsorship data
            const { data: sponsorships, error } = await supabase
                .from('sponsorship_sequences')
                .select('*')
                .order('slot', { ascending: true });

            if (error) throw error;

            if (!sponsorships || sponsorships.length === 0) {
                container.innerHTML = `
                    <div class="loading-state">
                        <i class="fas fa-star" style="font-size: 3rem; margin-bottom: 20px; color: #dee2e6;"></i>
                        <p>No featured items yet</p>
                        <button class="btn btn-gradient-primary mt-3" onclick="openSponsorshipModal()">
                            <i class="fas fa-plus me-2"></i>Add Your First Featured Item
                        </button>
                    </div>
                `;
                return;
            }

            // Fetch item details for each sponsorship
            const enrichedSponsorships = await Promise.all(sponsorships.map(async (sponsor) => {
                let itemData = null;
                try {
                    if (sponsor.item_type === 'note') {
                        const { data } = await supabase
                            .from('notes')
                            .select('*')
                            .eq('id', sponsor.item_id)
                            .single();
                        itemData = data ? { ...data, type: 'note' } : null;
                    } else if (sponsor.item_type === 'room') {
                        const { data } = await supabase
                            .from('rooms')
                            .select('*')
                            .eq('id', sponsor.item_id)
                            .single();
                        itemData = data ? { ...data, type: 'room' } : null;
                    } else {
                        const { data } = await supabase
                            .from('products')
                            .select('*')
                            .eq('id', sponsor.item_id)
                            .single();
                        itemData = data ? { ...data, type: 'product' } : null;
                    }
                } catch (error) {
                    console.error('Error fetching item details:', error);
                }

                return { ...sponsor, itemData };
            }));

            // Render modern sponsor cards
            container.innerHTML = enrichedSponsorships.map((sponsor, index) => {
                const item = sponsor.itemData;
                if (!item) return '';

                const title = item.title || item.name || item.hostel_name || 'Untitled';
                const price = item.price || item.fees || 0;
                const imageUrl = (Array.isArray(item.images) && item.images[0]) || 
                               (Array.isArray(item.image_urls) && item.image_urls[0]) || 
                               'https://via.placeholder.com/300x200?text=No+Image';

                const typeColors = {
                    'note': 'bg-info',
                    'room': 'bg-warning', 
                    'product': 'bg-success'
                };

                const typeIcons = {
                    'note': 'fas fa-book',
                    'room': 'fas fa-home',
                    'product': 'fas fa-shopping-bag'
                };

                return `
                    <div class="sponsor-item-card" draggable="true" data-sponsor-id="${sponsor.id}" data-slot="${sponsor.slot}">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="slot-number">${sponsor.slot}</div>
                            <div class="dropdown">
                                <button class="btn btn-link text-muted p-0" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="editSponsor(${sponsor.id})">
                                        <i class="fas fa-edit me-2"></i>Edit
                                    </a></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="removeSponsor(${sponsor.id})">
                                        <i class="fas fa-trash me-2"></i>Remove
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="item-image mb-3">
                            <img src="${imageUrl}" alt="${title}" class="img-fluid rounded" style="width: 100%; height: 150px; object-fit: cover;">
                        </div>
                        
                        <div class="item-details">
                            <span class="badge ${typeColors[item.type]} mb-2">
                                <i class="${typeIcons[item.type]} me-1"></i>
                                ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}
                            </span>
                            <h6 class="item-title mb-2">${title}</h6>
                            <div class="item-price text-success fw-bold mb-2">â‚¹${price.toLocaleString()}</div>
                            <div class="item-stats">
                                <small class="text-muted">
                                    <i class="fas fa-eye me-1"></i> 
                                    Views: ${Math.floor(Math.random() * 500) + 100}
                                </small>
                                <small class="text-muted ms-3">
                                    <i class="fas fa-clock me-1"></i>
                                    ${new Date(sponsor.created_at).toLocaleDateString()}
                                </small>
                            </div>
                        </div>
                        
                        <div class="item-actions mt-3">
                            <button class="btn btn-outline-primary btn-sm me-2" onclick="viewItem('${item.type}', '${item.id}')">
                                <i class="fas fa-eye me-1"></i>View
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="boostItem(${sponsor.id})">
                                <i class="fas fa-rocket me-1"></i>Boost
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Initialize drag and drop
            initializeDragAndDrop();

        } catch (error) {
            console.error('Error loading sponsorship sequence:', error);
            container.innerHTML = `
                <div class="loading-state">
                    <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <p class="text-danger">Error loading featured items</p>
                    <button class="btn btn-outline-primary mt-3" onclick="loadModernSponsorshipSequence()">
                        <i class="fas fa-sync me-2"></i>Try Again
                    </button>
                </div>
            `;
        }
    }

    // Load performance insights
    async function loadPerformanceInsights() {
        const container = document.getElementById('topPerformers');
        
        try {
            // Simulate performance data (replace with real analytics)
            const performanceData = [
                { rank: 1, title: 'JEE Physics Notes', views: 1250, type: 'note' },
                { rank: 2, title: 'MacBook Pro 13"', views: 980, type: 'product' },
                { rank: 3, title: 'Hostel Room - Deluxe', views: 756, type: 'room' }
            ];

            container.innerHTML = performanceData.map(item => `
                <div class="performance-item">
                    <div class="performance-rank">${item.rank}</div>
                    <div class="flex-grow-1">
                        <div class="fw-bold">${item.title}</div>
                        <small class="text-muted">${item.views} views â€¢ ${item.type}</small>
                    </div>
                    <div class="text-success fw-bold">
                        <i class="fas fa-arrow-up"></i> ${Math.floor(Math.random() * 20) + 5}%
                    </div>
                </div>
            `).join('');

        } catch (error) {
            container.innerHTML = `
                <div class="loading-state">
                    <div class="spinner-sm"></div>
                    <p>Unable to load performance data</p>
                </div>
            `;
        }
    }

    // Initialize drag and drop functionality
    function initializeDragAndDrop() {
        const cards = document.querySelectorAll('.sponsor-item-card');
        
        cards.forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragover', handleDragOver);
            card.addEventListener('drop', handleDrop);
            card.addEventListener('dragend', handleDragEnd);
        });
    }

    function handleDragStart(e) {
        e.target.classList.add('dragging');
        e.dataTransfer.setData('text/plain', e.target.dataset.sponsorId);
    }

    function handleDragOver(e) {
        e.preventDefault();
    }

    function handleDrop(e) {
        e.preventDefault();
        const draggedId = e.dataTransfer.getData('text/plain');
        const targetId = e.target.closest('.sponsor-item-card')?.dataset.sponsorId;
        
        if (draggedId !== targetId) {
            // Implement reordering logic here
            console.log('Reorder:', draggedId, 'to position of', targetId);
            showNotification('Reordering feature coming soon!', 'info');
        }
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging');
    }

    // Global utility functions
    window.showNotification = function(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
        
        notification.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    };

    // Enhanced Modern Sponsorship Modal Functions
    window.openSponsorshipModal = function() {
        const modal = new bootstrap.Modal(document.getElementById('sponsorshipModal'));
        
        // Initialize modern modal
        initializeModernModal();
        
        // Load available items in the modern search panel
        loadAvailableItems();
        modal.show();
    };

    // Initialize modern modal elements
    function initializeModernModal() {
        // Reset selection state
        window.selectedItem = null;
        
        // Reset search
        const searchInput = document.getElementById('itemSearch');
        const typeFilter = document.getElementById('typeFilter');
        const confirmBtn = document.getElementById('confirmAddSponsor');
        
        if (searchInput) searchInput.value = '';
        if (typeFilter) typeFilter.value = '';
        if (confirmBtn) {
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<i class="fas fa-star me-2"></i>Select an Item';
        }
    }

    // Load available items with modern design
    async function loadAvailableItems() {
        const container = document.getElementById('availableItems');
        if (!container) return;
        
        try {
            // Show loading state
            container.innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading available items...</p>
                </div>
            `;

            // Load all items in parallel
            const [notesResult, roomsResult, productsResult] = await Promise.all([
                supabase.from('notes').select('*').order('created_at', { ascending: false }),
                supabase.from('rooms').select('*').order('created_at', { ascending: false }),
                supabase.from('products').select('*').order('created_at', { ascending: false })
            ]);

            const allItems = [
                ...(notesResult.data || []).map(item => ({ ...item, type: 'note' })),
                ...(roomsResult.data || []).map(item => ({ ...item, type: 'room' })),
                ...(productsResult.data || []).map(item => ({ ...item, type: 'product' }))
            ];

            if (allItems.length === 0) {
                container.innerHTML = `
                    <div class="loading-state">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 20px; color: #dee2e6;"></i>
                        <p>No items available for featuring</p>
                    </div>
                `;
                return;
            }

            // Render items in modern grid
            container.innerHTML = `
                <div class="items-grid">
                    ${allItems.map(item => {
                        const title = item.title || item.name || item.hostel_name || 'Untitled';
                        const price = item.price || item.fees || 0;
                        const imageUrl = (Array.isArray(item.images) && item.images[0]) || 
                                       (Array.isArray(item.image_urls) && item.image_urls[0]) || 
                                       'https://via.placeholder.com/200x150?text=No+Image';

                        const typeColors = {
                            'note': 'bg-info',
                            'room': 'bg-warning',
                            'product': 'bg-success'
                        };

                        const typeIcons = {
                            'note': 'fas fa-book',
                            'room': 'fas fa-home',
                            'product': 'fas fa-shopping-bag'
                        };

                        return `
                            <div class="item-card" onclick="selectItem('${item.type}', '${item.id}', '${title.replace(/'/g, "\\'")}')">
                                <div class="item-image">
                                    <img src="${imageUrl}" alt="${title}" class="img-fluid">
                                    <span class="badge ${typeColors[item.type]} type-badge">
                                        <i class="${typeIcons[item.type]} me-1"></i>
                                        ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}
                                    </span>
                                </div>
                                <div class="item-info">
                                    <h6 class="item-title">${title}</h6>
                                    <div class="item-price text-success fw-bold">â‚¹${price.toLocaleString()}</div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

        } catch (error) {
            console.error('Error loading available items:', error);
            container.innerHTML = `
                <div class="loading-state">
                    <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <p class="text-danger">Error loading items</p>
                    <button class="btn btn-outline-primary mt-3" onclick="loadAvailableItems()">
                        <i class="fas fa-sync me-2"></i>Try Again
                    </button>
                </div>
            `;
        }
    }

    // Modern item selection handler
    function selectItem(type, id, title) {
        // Visual feedback
        document.querySelectorAll('.item-card').forEach(card => card.classList.remove('selected'));
        event.currentTarget.classList.add('selected');

        // Store selection
        window.selectedItem = { type, id, title };

        // Update confirm button
        const confirmBtn = document.getElementById('confirmAddSponsor');
        if (confirmBtn) {
            confirmBtn.disabled = false;
            confirmBtn.innerHTML = `<i class="fas fa-star me-2"></i>Feature "${title}"`;
        }
    }

    // Enhanced search functionality
    function searchItems() {
        const searchTerm = document.getElementById('itemSearch')?.value.toLowerCase() || '';
        const typeFilter = document.getElementById('typeFilter')?.value || '';
        const items = document.querySelectorAll('.item-card');

        items.forEach(item => {
            const title = item.querySelector('.item-title')?.textContent.toLowerCase() || '';
            const type = item.querySelector('.type-badge')?.textContent.toLowerCase().trim() || '';
            
            const matchesSearch = !searchTerm || title.includes(searchTerm);
            const matchesType = !typeFilter || type.includes(typeFilter.toLowerCase());

            item.style.display = matchesSearch && matchesType ? 'block' : 'none';
        });
    }

    // Modern sponsorship confirmation
    async function confirmAddSponsor() {
        if (!window.selectedItem) {
            showNotification('Please select an item to feature', 'warning');
            return;
        }

        const confirmBtn = document.getElementById('confirmAddSponsor');
        const originalContent = confirmBtn?.innerHTML || '';
        
        try {
            // Show loading state
            if (confirmBtn) {
                confirmBtn.disabled = true;
                confirmBtn.innerHTML = '<div class="spinner-sm me-2"></div>Adding...';
            }

            // Find next available slot
            const { data: existingSponsors } = await supabase
                .from('sponsorship_sequences')
                .select('slot')
                .order('slot', { ascending: false })
                .limit(1);

            const nextSlot = existingSponsors && existingSponsors.length > 0 
                ? existingSponsors[0].slot + 1 
                : 1;

            // Insert new sponsorship
            const { error } = await supabase
                .from('sponsorship_sequences')
                .insert({
                    item_id: window.selectedItem.id,
                    item_type: window.selectedItem.type,
                    slot: nextSlot,
                    is_active: true,
                    user_id: currentUser.id
                });

            if (error) throw error;

            // Success feedback
            showNotification(`"${window.selectedItem.title}" has been featured successfully!`, 'success');
            
            // Close modal and refresh
            const modalElement = document.getElementById('sponsorshipModal');
            if (modalElement) {
                const modalInstance = bootstrap.Modal.getInstance(modalElement);
                if (modalInstance) modalInstance.hide();
            }
            
            await loadModernSponsorshipSequence();
            await loadSponsorshipMetrics();

        } catch (error) {
            console.error('Error adding sponsorship:', error);
            showNotification('Error featuring item: ' + error.message, 'error');
        } finally {
            if (confirmBtn) {
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalContent;
            }
        }
    }

    // Additional Modern Helper Functions
    function editSponsor(sponsorId) {
        showNotification('Edit feature coming soon!', 'info');
    }

    async function removeSponsor(sponsorId) {
        if (!confirm('Are you sure you want to remove this featured item?')) return;

        try {
            const { error } = await supabase
                .from('sponsorship_sequences')
                .delete()
                .eq('id', sponsorId);

            if (error) throw error;

            showNotification('Featured item removed successfully!', 'success');
            await loadModernSponsorshipSequence();
            await loadSponsorshipMetrics();

        } catch (error) {
            console.error('Error removing sponsorship:', error);
            showNotification('Error removing featured item: ' + error.message, 'error');
        }
    }

    function viewItem(type, id) {
        const urls = {
            'note': `note.html?id=${id}`,
            'room': `room.html?id=${id}`,
            'product': `product.html?id=${id}`
        };
        
        if (urls[type]) {
            window.open(urls[type], '_blank');
        }
    }

    function boostItem(sponsorId) {
        showNotification('Boost feature coming soon!', 'info');
    }

    // Enhanced notification system
    function showNotification(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-bg-${type === 'error' ? 'danger' : type} border-0`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');
        
        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        `;
        
        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toast-container';
            toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
            toastContainer.style.zIndex = '9999';
            document.body.appendChild(toastContainer);
        }
        
        toastContainer.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        // Remove toast element after it's hidden
        toast.addEventListener('hidden.bs.toast', () => {
            toast.remove();
        });
    }

    window.searchModalItems = function() {
        searchItems();
    };

    window.saveSponsorshipChanges = async function() {
        try {
            const slots = document.querySelectorAll('.sponsor-slot');
            const sponsorships = [];
            
            slots.forEach(slot => {
                const sponsoredItem = slot.querySelector('.sponsored-item');
                if (sponsoredItem) {
                    sponsorships.push({
                        slot: parseInt(slot.dataset.slot),
                        item_id: sponsoredItem.dataset.itemId,
                        item_type: sponsoredItem.dataset.itemType
                    });
                }
            });

            // Clear existing sponsorships
            await supabase.from('sponsorship_sequences').delete().neq('id', 0);
            
            // Insert new sponsorships
            if (sponsorships.length > 0) {
                const { error } = await supabase
                    .from('sponsorship_sequences')
                    .insert(sponsorships);
                    
                if (error) throw error;
            }

            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('sponsorshipModal'));
            modal.hide();
            
            showNotification('Sponsorship changes saved successfully!', 'success');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('Error saving sponsorship changes:', error);
            showNotification('Error saving changes: ' + error.message, 'error');
        }
    };

    // Initialize modern sponsorship interface when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize sponsorship page if we're on the right section
        if (document.getElementById('sponsorshipSequence')) {
            console.log('ðŸš€ Initializing modern sponsorship interface...');
            setTimeout(renderSponsorshipPage, 500);
        }

        // Add event listeners for search functionality
        const itemSearch = document.getElementById('itemSearch');
        const typeFilter = document.getElementById('typeFilter');
        
        if (itemSearch) {
            itemSearch.addEventListener('input', searchItems);
        }
        
        if (typeFilter) {
            typeFilter.addEventListener('change', searchItems);
        }

        // Add event listener for modal confirm button
        const confirmBtn = document.getElementById('confirmAddSponsor');
        if (confirmBtn) {
            confirmBtn.addEventListener('click', confirmAddSponsor);
        }
    });

    // Initialize drag and drop functionality
    function initializeDragAndDrop() {
        const cards = document.querySelectorAll('.sponsor-item-card');
        
        cards.forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragover', handleDragOver);
            card.addEventListener('drop', handleDrop);
            card.addEventListener('dragend', handleDragEnd);
        });
    }

    function handleDragStart(e) {
        e.target.classList.add('dragging');
        e.dataTransfer.setData('text/plain', e.target.dataset.sponsorId);
    }

    function handleDragOver(e) {
        e.preventDefault();
        e.target.closest('.sponsor-item-card')?.classList.add('drag-over');
    }

    function handleDrop(e) {
        e.preventDefault();
        const draggedId = e.dataTransfer.getData('text/plain');
        const targetCard = e.target.closest('.sponsor-item-card');
        const targetId = targetCard?.dataset.sponsorId;
        
        // Remove drag-over class
        targetCard?.classList.remove('drag-over');
        
        if (draggedId !== targetId && targetId) {
            // Implement reordering logic here
            console.log('Reorder:', draggedId, 'to position of', targetId);
            showNotification('Reordering feature will be available soon!', 'info');
        }
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging');
        document.querySelectorAll('.sponsor-item-card').forEach(card => {
            card.classList.remove('drag-over');
        });
    }

    // Enhanced sponsorship analytics
    async function loadSponsorshipMetrics() {
        try {
            // Get total sponsored items
            const { data: totalSponsored, error: totalError } = await supabase
                .from('sponsorship_sequences')
                .select('id', { count: 'exact' });

            if (totalError) throw totalError;

            // Get active sponsored items
            const { data: activeSponsored, error: activeError } = await supabase
                .from('sponsorship_sequences')
                .select('id', { count: 'exact' })
                .eq('is_active', true);

            if (activeError) throw activeError;

            // Simulate other metrics (replace with real analytics)
            const metrics = {
                total: totalSponsored?.length || 0,
                active: activeSponsored?.length || 0,
                totalViews: Math.floor(Math.random() * 10000) + 5000,
                clickThrough: (Math.random() * 5 + 2).toFixed(1)
            };

            // Update metric displays
            updateMetricDisplay('totalSponsoredItems', metrics.total);
            updateMetricDisplay('activeSponsoredItems', metrics.active);
            updateMetricDisplay('totalSponsorViews', metrics.totalViews.toLocaleString());
            updateMetricDisplay('sponsorClickRate', metrics.clickThrough + '%');

        } catch (error) {
            console.error('Error loading sponsorship metrics:', error);
        }
    }

    function updateMetricDisplay(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = value;
        }
    }

    console.log('âœ… Modern sponsorship management system loaded successfully!');

    window.removeSponsorFromSlot = function(button) {
        const slot = button.closest('.sponsor-slot');
        const slotNumber = slot.dataset.slot;
        const slotContent = slot.querySelector('.slot-content');
        
        slotContent.innerHTML = `
            <div class="text-center text-muted">
                <i class="fas fa-plus"></i>
                <br><small>Drop item here</small>
            </div>
        `;
        
        showNotification(`Item removed from sponsor slot ${slotNumber}`, 'info');
    };

    // Open sponsorship modal - legacy function name
    function openSponsorshipModal() {
        window.openSponsorshipModal();
    }

    // Load modal items function
    async function loadModalItems() {
        try {
            const container = document.getElementById('modalItemsList');
            if (!container) return;

            // Load notes
            const { data: notes, error: notesError } = await supabase
                .from('notes')
                .select('*')
                .order('created_at', { ascending: false });

            if (notesError) throw notesError;

            // Load products (if available)
            const { data: products, error: productsError } = await supabase
                .from('products')
                .select('*')
                .order('created_at', { ascending: false });

            // Load user-generated content (if available)
            const { data: userContent, error: userContentError } = await supabase
                .from('user_profiles')
                .select('id, full_name, created_at')
                .order('created_at', { ascending: false });

            let itemsHTML = '';

            // Add notes
            notes?.forEach(note => {
                itemsHTML += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="item-card card h-100" draggable="true" 
                             data-item-id="${note.id}" data-item-type="note"
                             ondragstart="handleDragStart(event)">
                            <div class="card-body">
                                <h6 class="card-title text-truncate">${note.title || 'Untitled Note'}</h6>
                                <p class="card-text small text-muted text-truncate">
                                    ${note.content ? note.content.substring(0, 100) + '...' : 'No content'}
                                </p>
                                <span class="badge bg-primary">Note</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Add products if available
            products?.forEach(product => {
                itemsHTML += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="item-card card h-100" draggable="true" 
                             data-item-id="${product.id}" data-item-type="product"
                             ondragstart="handleDragStart(event)">
                            <div class="card-body">
                                <h6 class="card-title text-truncate">${product.name || 'Untitled Product'}</h6>
                                <p class="card-text small text-muted text-truncate">
                                    ${product.description ? product.description.substring(0, 100) + '...' : 'No description'}
                                </p>
                                <span class="badge bg-success">Product</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Add user content if available
            userContent?.forEach(user => {
                itemsHTML += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="item-card card h-100" draggable="true" 
                             data-item-id="${user.id}" data-item-type="user"
                             ondragstart="handleDragStart(event)">
                            <div class="card-body">
                                <h6 class="card-title text-truncate">${user.full_name || 'Anonymous User'}</h6>
                                <p class="card-text small text-muted">User Profile</p>
                                <span class="badge bg-info">User</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = itemsHTML || '<div class="col-12"><p class="text-muted text-center">No items available</p></div>';

        } catch (error) {
            console.error('Error loading modal items:', error);
            const container = document.getElementById('modalItemsList');
            if (container) {
                container.innerHTML = '<div class="col-12"><div class="alert alert-danger">Error loading items</div></div>';
            }
        }
    }

    // Generate sponsor slots
    function generateSponsorSlots() {
        const container = document.getElementById('sponsorSlotsList');
        if (!container) return;

        let slotsHTML = '';
        for (let i = 1; i <= 12; i++) {
            slotsHTML += `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="sponsor-slot border rounded p-3" 
                         data-slot="${i}"
                         ondrop="handleDrop(event)" 
                         ondragover="handleDragOver(event)">
                        <h6 class="text-center mb-3">Sponsor Slot ${i}</h6>
                        <div class="slot-content text-center text-muted">
                            <i class="fas fa-plus"></i>
                            <br><small>Drop item here</small>
                        </div>
                    </div>
                </div>
            `;
        }
        container.innerHTML = slotsHTML;
    }

    // Drag and drop handlers
    window.handleDragStart = function(event) {
        const itemCard = event.target.closest('.item-card');
        event.dataTransfer.setData('text/plain', JSON.stringify({
            itemId: itemCard.dataset.itemId,
            itemType: itemCard.dataset.itemType,
            title: itemCard.querySelector('h6').textContent,
            description: itemCard.querySelector('p').textContent
        }));
    };

    window.handleDragOver = function(event) {
        event.preventDefault();
        event.currentTarget.classList.add('drag-over');
    };

    window.handleDrop = function(event) {
        event.preventDefault();
        event.currentTarget.classList.remove('drag-over');
        
        try {
            const data = JSON.parse(event.dataTransfer.getData('text/plain'));
            const slot = event.currentTarget;
            const slotContent = slot.querySelector('.slot-content');
            
            slotContent.innerHTML = `
                <div class="sponsored-item" data-item-id="${data.itemId}" data-item-type="${data.itemType}">
                    <h6 class="text-truncate mb-1">${data.title}</h6>
                    <p class="small text-muted mb-2 text-truncate">${data.description}</p>
                    <span class="badge bg-${data.itemType === 'note' ? 'primary' : data.itemType === 'product' ? 'success' : 'info'}">${data.itemType}</span>
                    <button class="btn btn-sm btn-outline-danger mt-2" onclick="removeSponsorFromSlot(this)">
                        <i class="fas fa-times"></i> Remove
                    </button>
                </div>
            `;
            
            showNotification(`Item added to sponsor slot ${slot.dataset.slot}`, 'success');
        } catch (error) {
            console.error('Error handling drop:', error);
            showNotification('Error adding item to slot', 'error');
        }
    };

    // Load items for modal selection
    async function loadModalItems() {
        try {
            const [
                { data: products = [] },
                { data: notes = [] },
                { data: rooms = [] }
            ] = await Promise.all([
                supabase.from('products').select('*'),
                supabase.from('notes').select('*'),
                supabase.from('rooms').select('*')
            ]);

            const allItems = [
                ...products.map(p => ({...p, type: 'product'})),
                ...notes.map(n => ({...n, type: 'note'})),
                ...rooms.map(r => ({...r, type: 'room'}))
            ];

            displayModalItems(allItems);
        } catch (error) {
            console.error('Error loading modal items:', error);
            document.getElementById('modalItemsList').innerHTML = 
                '<div class="alert alert-danger">Error loading items</div>';
        }
    }

    // Display items in modal
    function displayModalItems(items) {
        const container = document.getElementById('modalItemsList');
        
        if (items.length === 0) {
            container.innerHTML = '<div class="text-center py-4 text-muted">No items found</div>';
            return;
        }

        const itemsHTML = items.map(item => `
            <div class="item-card" draggable="true" data-item-id="${item.id}" data-item-type="${item.type}">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">${item.title || item.name || 'Untitled'}</h6>
                        <p class="mb-1 text-muted small">${item.description || 'No description'}</p>
                        <div class="d-flex gap-2">
                            <span class="badge bg-primary">${item.type}</span>
                            ${item.college ? `<span class="badge bg-secondary">${item.college}</span>` : ''}
                            ${item.price ? `<span class="badge bg-success">â‚¹${item.price}</span>` : ''}
                        </div>
                    </div>
                    <div class="text-end">
                        <small class="text-muted">ID: ${item.id}</small>
                    </div>
                </div>
            </div>
        `).join('');

        container.innerHTML = itemsHTML;

        // Add drag event listeners
        container.querySelectorAll('.item-card').forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);
        });
    }

    // Generate sponsor slots
    function generateSponsorSlots() {
        const container = document.getElementById('sponsorSlots');
        const slotsHTML = Array.from({length: 10}, (_, i) => `
            <div class="sponsor-slot drop-zone" data-slot="${i + 1}">
                <div class="slot-number">${i + 1}</div>
                <div class="slot-content">
                    <div class="text-center text-muted">
                        <i class="fas fa-plus"></i>
                        <br><small>Drop item here</small>
                    </div>
                </div>
            </div>
        `).join('');

        container.innerHTML = slotsHTML;

        // Add drop event listeners
        container.querySelectorAll('.sponsor-slot').forEach(slot => {
            slot.addEventListener('dragover', handleDragOver);
            slot.addEventListener('drop', handleDrop);
            slot.addEventListener('dragenter', handleDragEnter);
            slot.addEventListener('dragleave', handleDragLeave);
        });
    }

    // Drag and drop handlers
    function handleDragStart(e) {
        e.target.classList.add('dragging');
        e.dataTransfer.setData('text/plain', JSON.stringify({
            id: e.target.dataset.itemId,
            type: e.target.dataset.itemType,
            title: e.target.querySelector('h6').textContent
        }));
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging');
    }

    function handleDragOver(e) {
        e.preventDefault();
    }

    function handleDragEnter(e) {
        e.preventDefault();
        e.target.closest('.sponsor-slot').classList.add('drag-over');
    }

    function handleDragLeave(e) {
        if (!e.target.closest('.sponsor-slot').contains(e.relatedTarget)) {
            e.target.closest('.sponsor-slot').classList.remove('drag-over');
        }
    }

    function handleDrop(e) {
        e.preventDefault();
        const slot = e.target.closest('.sponsor-slot');
        slot.classList.remove('drag-over');
        
        const itemData = JSON.parse(e.dataTransfer.getData('text/plain'));
        const slotNumber = slot.dataset.slot;
        
        // Update slot content
        const slotContent = slot.querySelector('.slot-content');
        slotContent.innerHTML = `
            <div class="sponsored-item" data-item-id="${itemData.id}" data-item-type="${itemData.type}">
                <div>
                    <strong>${itemData.title}</strong>
                    <br><small class="text-muted">${itemData.type} â€¢ ID: ${itemData.id}</small>
                </div>
                <button class="remove-sponsor" onclick="removeSponsorFromSlot(this)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        showNotification(`Item added to sponsor slot ${slotNumber}`, 'success');
    }

    // Remove sponsor from slot
    function removeSponsorFromSlot(button) {
        const slot = button.closest('.sponsor-slot');
        const slotNumber = slot.dataset.slot;
        const slotContent = slot.querySelector('.slot-content');
        
        slotContent.innerHTML = `
            <div class="text-center text-muted">
                <i class="fas fa-plus"></i>
                <br><small>Drop item here</small>
            </div>
        `;
        
        showNotification(`Item removed from sponsor slot ${slotNumber}`, 'info');
    }

    // Save sponsorship changes
    async function saveSponsorshipChanges() {
        try {
            const slots = document.querySelectorAll('.sponsor-slot');
            const sponsorships = [];
            
            slots.forEach(slot => {
                const sponsoredItem = slot.querySelector('.sponsored-item');
                if (sponsoredItem) {
                    sponsorships.push({
                        slot: parseInt(slot.dataset.slot),
                        item_id: sponsoredItem.dataset.itemId,
                        item_type: sponsoredItem.dataset.itemType
                    });
                }
            });

            // Clear existing sponsorships
            await supabase.from('sponsorship_sequences').delete().neq('id', 0);
            
            // Insert new sponsorships
            if (sponsorships.length > 0) {
                const { error } = await supabase
                    .from('sponsorship_sequences')
                    .insert(sponsorships);
                    
                if (error) throw error;
            }

            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('sponsorshipModal'));
            modal.hide();
            
            showNotification('Sponsorship changes saved successfully!', 'success');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('Error saving sponsorship changes:', error);
            showNotification('Error saving changes: ' + error.message, 'error');
        }
    }

    // Search items in modal
    function searchModalItems() {
        const searchTerm = document.getElementById('modalItemSearch').value.toLowerCase();
        const typeFilter = document.getElementById('modalItemType').value;
        
        const itemCards = document.querySelectorAll('.item-card');
        
        itemCards.forEach(card => {
            const title = card.querySelector('h6').textContent.toLowerCase();
            const description = card.querySelector('p').textContent.toLowerCase();
            const type = card.dataset.itemType;
            
            const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
            const matchesType = typeFilter === 'all' || type === typeFilter;
            
            card.style.display = matchesSearch && matchesType ? 'block' : 'none';
        });
    }

    async function loadSponsorshipSequence() {
        try {
            const { data: sponsorshipSeq, error } = await supabase
                .from('sponsorship_sequences')
                .select('*')
                .order('slot', { ascending: true });
                
            if (error) {
                console.error('Error loading sponsorship sequence:', error);
                document.getElementById('sponsorshipSequence').innerHTML = 
                    '<div class="alert alert-danger">Error loading sponsorship data</div>';
                return;
            }
            
            if (!sponsorshipSeq || sponsorshipSeq.length === 0) {
                document.getElementById('sponsorshipSequence').innerHTML = 
                    '<div class="alert alert-info">No sponsored items found. Add some to get started!</div>';
                document.getElementById('activeSponsorCount').textContent = '0';
                return;
            }
            
            // Update count
            document.getElementById('activeSponsorCount').textContent = sponsorshipSeq.length;
            
            // Get details for each sponsored item
            const sponsorDetails = await Promise.all(sponsorshipSeq.map(async (sponsor) => {
                let itemData = null;
                let itemError = null;
                
                try {
                    const table = sponsor.item_type === 'note' ? 'notes' : 
                                 sponsor.item_type === 'room' ? 'rooms' : 'products';
                    
                    const { data, error } = await supabase
                        .from(table)
                        .select('*')
                        .eq('id', sponsor.item_id)
                        .single();
                        
                    if (error) {
                        itemError = error.message;
                    } else {
                        itemData = data;
                    }
                } catch (err) {
                    itemError = err.message;
                }
                
                return {
                    ...sponsor,
                    itemData,
                    itemError
                };
            }));
            
            // Render sponsorship sequence
            const sequenceHTML = sponsorDetails.map(sponsor => {
                const item = sponsor.itemData;
                const hasError = sponsor.itemError || !item;
                
                return `
                    <div class="sponsorship-item d-flex align-items-center justify-content-between p-3 mb-2 border rounded ${hasError ? 'border-danger bg-light' : 'border-success bg-light'}">
                        <div class="d-flex align-items-center">
                            <div class="sponsor-slot badge bg-primary me-3">${sponsor.slot}</div>
                            <div>
                                ${hasError ? `
                                    <h6 class="mb-1 text-danger">
                                        <i class="fas fa-exclamation-triangle"></i> Error: Item not found
                                    </h6>
                                    <small class="text-muted">
                                        Type: ${sponsor.item_type} | ID: ${sponsor.item_id}
                                    </small>
                                ` : `
                                    <h6 class="mb-1">${item.title || item.name || 'Untitled'}</h6>
                                    <small class="text-muted">
                                        <span class="badge bg-secondary me-1">${sponsor.item_type}</span>
                                        ID: ${sponsor.item_id}
                                        ${item.college ? ` | ${item.college}` : ''}
                                        ${item.price ? ` | Rs.${item.price}` : ''}
                                    </small>
                                `}
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="editSponsorshipSlot('${sponsor.item_id}', ${sponsor.slot})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="removeSponsorshipItem('${sponsor.item_id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('sponsorshipSequence').innerHTML = sequenceHTML;
            
        } catch (error) {
            console.error('Error in loadSponsorshipSequence:', error);
            document.getElementById('sponsorshipSequence').innerHTML = 
                '<div class="alert alert-danger">Failed to load sponsorship data</div>';
        }
    }

    function setupSponsorshipForm() {
        const form = document.getElementById('addSponsorshipForm');
        if (!form) return;
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const itemType = document.getElementById('itemType').value;
            const itemId = document.getElementById('itemId').value;
            const slot = parseInt(document.getElementById('sponsorSlot').value);
            
            if (!itemType || !itemId || !slot) {
                alert('Please fill all fields');
                return;
            }
            
            try {
                // Check if item exists
                const table = itemType === 'note' ? 'notes' : 
                             itemType === 'room' ? 'rooms' : 'products';
                
                const { data: itemCheck, error: itemError } = await supabase
                    .from(table)
                    .select('id, title, name')
                    .eq('id', itemId)
                    .single();
                    
                if (itemError || !itemCheck) {
                    alert('Item not found! Please check the ID and type.');
                    return;
                }
                
                // Add to sponsorship sequence
                const { error: insertError } = await supabase
                    .from('sponsorship_sequences')
                    .insert({
                        item_id: itemId,
                        item_type: itemType,
                        slot: slot
                    });
                    
                if (insertError) {
                    alert('Failed to add sponsorship: ' + insertError.message);
                    return;
                }
                
                alert('Item added to sponsors successfully!');
                form.reset();
                await loadSponsorshipSequence();
                
            } catch (error) {
                console.error('Error adding sponsorship:', error);
                alert('Error adding sponsorship: ' + error.message);
            }
        });
    }

    function setupItemSearch() {
        const searchBtn = document.querySelector('button[onclick="searchItems()"]');
        if (searchBtn) {
            searchBtn.onclick = searchItems;
        }
        
        // Add enter key support
        const searchInput = document.getElementById('itemSearchInput');
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchItems();
                }
            });
        }
    }

    async function searchItems() {
        const searchTerm = document.getElementById('itemSearchInput').value.trim();
        const typeFilter = document.getElementById('itemTypeFilter').value;
        
        if (!searchTerm) {
            alert('Please enter a search term');
            return;
        }
        
        const resultsDiv = document.getElementById('itemSearchResults');
        resultsDiv.innerHTML = '<div class="d-flex justify-content-center"><div class="spinner-border" role="status"></div></div>';
        
        try {
            const searchTables = typeFilter === 'all' ? ['products', 'notes', 'rooms'] : [typeFilter === 'product' ? 'products' : typeFilter === 'note' ? 'notes' : 'rooms'];
            
            const searchResults = [];
            
            for (const table of searchTables) {
                const { data, error } = await supabase
                    .from(table)
                    .select('*')
                    .or(`title.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%,name.ilike.%${searchTerm}%,id.eq.${searchTerm}`)
                    .limit(10);
                    
                if (!error && data) {
                    data.forEach(item => {
                        searchResults.push({
                            ...item,
                            _type: table.slice(0, -1) // Remove 's' from table name
                        });
                    });
                }
            }
            
            if (searchResults.length === 0) {
                resultsDiv.innerHTML = '<div class="alert alert-info">No items found matching your search.</div>';
                return;
            }
            
            const resultsHTML = searchResults.map(item => `
                <div class="search-result-item d-flex align-items-center justify-content-between p-2 mb-2 border rounded">
                    <div>
                        <h6 class="mb-1">${item.title || item.name || 'Untitled'}</h6>
                        <small class="text-muted">
                            <span class="badge bg-secondary me-1">${item._type}</span>
                            ID: ${item.id}
                            ${item.college ? ` | ${item.college}` : ''}
                            ${item.price ? ` | Rs.${item.price}` : ''}
                        </small>
                    </div>
                    <button class="btn btn-sm btn-primary" onclick="addToSponsorship('${item.id}', '${item._type}')">
                        <i class="fas fa-star"></i> Sponsor This
                    </button>
                </div>
            `).join('');
            
            resultsDiv.innerHTML = resultsHTML;
            
        } catch (error) {
            console.error('Search error:', error);
            resultsDiv.innerHTML = '<div class="alert alert-danger">Search failed: ' + error.message + '</div>';
        }
    }

    async function addToSponsorship(itemId, itemType) {
        const slot = prompt('Enter sponsorship slot (1-10):', '1');
        if (!slot || isNaN(slot) || slot < 1 || slot > 10) {
            alert('Please enter a valid slot number (1-10)');
            return;
        }
        
        try {
            const { error } = await supabase
                .from('sponsorship_sequences')
                .insert({
                    item_id: itemId,
                    item_type: itemType,
                    slot: parseInt(slot)
                });
                
            if (error) {
                alert('Failed to add to sponsorship: ' + error.message);
                return;
            }
            
            showNotification('Item added to sponsors successfully!', 'success');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('Error adding to sponsorship:', error);
            alert('Error: ' + error.message);
        }
    }

    // Remove sponsorship item
    async function removeSponsorshipItem(itemId) {
        if (!confirm('Are you sure you want to remove this item from sponsors?')) return;
        
        try {
            const { error } = await supabase
                .from('sponsorship_sequences')
                .delete()
                .eq('item_id', itemId);
                
            if (error) {
                alert('Failed to remove from sponsorship: ' + error.message);
                return;
            }
            
            showNotification('Item removed from sponsors', 'success');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('Error removing sponsorship:', error);
            alert('Error: ' + error.message);
        }
    }

    // Edit sponsorship slot
    async function editSponsorshipSlot(itemId, currentSlot) {
        const newSlot = prompt(`Enter new slot number (current: ${currentSlot}):`);
        if (!newSlot || isNaN(newSlot) || newSlot < 1 || newSlot > 10) return;
        
        try {
            const { error } = await supabase
                .from('sponsorship_sequences')
                .update({ slot: parseInt(newSlot) })
                .eq('item_id', itemId);
                
            if (error) {
                alert('Failed to update slot: ' + error.message);
                return;
            }
            
            showNotification('Slot updated successfully!', 'success');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('Error updating slot:', error);
            alert('Error: ' + error.message);
        }
    }

    // Load sponsorship metrics
    async function loadSponsorshipMetrics() {
        try {
            const { data: sponsorships, error } = await supabase
                .from('sponsorship_sequences')
                .select('*');
                
            if (!error && sponsorships) {
                document.getElementById('activeSponsorCount').textContent = sponsorships.length;
                
                // Calculate estimated revenue (placeholder)
                const estimatedRevenue = sponsorships.length * 100; // Rs. 100 per sponsor
                document.getElementById('sponsorRevenue').textContent = `â‚¹${estimatedRevenue}`;
            }
        } catch (error) {
            console.error('Error loading sponsorship metrics:', error);
        }
    }

    async function removeSponsorshipItem(itemId) {
        console.log('ðŸ—‘ï¸ Removing sponsorship item:', itemId);
        
        if (!confirm('Are you sure you want to remove this item from sponsors?')) return;
        
        try {
            const { error } = await supabase
                .from('sponsorship_sequences')
                .delete()
                .eq('item_id', itemId);
                
            if (error) {
                console.error('âŒ Delete error:', error);
                alert('Failed to remove sponsorship: ' + error.message);
                return;
            }
            
            console.log('âœ… Item removed successfully');
            alert('Item removed from sponsors successfully!');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('âŒ Error removing sponsorship:', error);
            alert('Error: ' + error.message);
        }
    }

    async function editSponsorshipSlot(itemId, currentSlot) {
        console.log('âœï¸ Editing sponsorship slot for:', itemId, 'current slot:', currentSlot);
        
        const newSlot = prompt(`Enter new slot for this item (current: ${currentSlot}):`, currentSlot);
        if (!newSlot || isNaN(newSlot) || newSlot < 1 || newSlot > 10) {
            alert('Please enter a valid slot number (1-10)');
            return;
        }
        
        if (parseInt(newSlot) === currentSlot) return;
        
        try {
            const { error } = await supabase
                .from('sponsorship_sequences')
                .update({ slot: parseInt(newSlot) })
                .eq('item_id', itemId);
                
            if (error) {
                console.error('âŒ Update error:', error);
                alert('Failed to update slot: ' + error.message);
                return;
            }
            
            console.log('âœ… Slot updated successfully');
            alert('Slot updated successfully!');
            await loadSponsorshipSequence();
            
        } catch (error) {
            console.error('âŒ Error updating slot:', error);
            alert('Error: ' + error.message);
        }
    }

    async function refreshSponsorshipSequence() {
        console.log('ðŸ”„ Refreshing sponsorship sequence...');
        try {
            await loadSponsorshipSequence();
            console.log('âœ… Sponsorship sequence refreshed');
        } catch (error) {
            console.error('âŒ Error refreshing:', error);
            alert('Failed to refresh: ' + error.message);
        }
    }

    async function loadSponsorshipMetrics() {
        try {
            // Simulated metrics (in a real app, these would come from analytics)
            document.getElementById('sponsorRevenue').textContent = 'Rs.2,500';
            document.getElementById('sponsorViews').textContent = '12,450';
            document.getElementById('expiringSponsorships').textContent = '0';
            
        } catch (error) {
            console.error('Error loading sponsorship metrics:', error);
        }
    }

    // Make sponsorship functions globally accessible for onclick handlers
    window.refreshSponsorshipSequence = refreshSponsorshipSequence;
    window.removeSponsorshipItem = removeSponsorshipItem;
    window.editSponsorshipSlot = editSponsorshipSlot;
    window.searchItems = searchItems;
    window.addToSponsorship = addToSponsorship;
    
    // Debug function availability
    console.log('ðŸ”§ Sponsorship functions attached to window:');
    console.log('- refreshSponsorshipSequence:', typeof window.refreshSponsorshipSequence);
    console.log('- removeSponsorshipItem:', typeof window.removeSponsorshipItem);
    console.log('- editSponsorshipSlot:', typeof window.editSponsorshipSlot);
    console.log('- searchItems:', typeof window.searchItems);
    console.log('- addToSponsorship:', typeof window.addToSponsorship);

    // ========================================
    // ENHANCED ADMIN PANEL FEATURES
    // ========================================

    // Theme Toggle Functionality
    function initThemeToggle() {
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const icon = themeToggle.querySelector('i');
        
        // Load saved theme
        const savedTheme = localStorage.getItem('adminTheme') || 'light';
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            icon.className = 'fas fa-sun';
        }
        
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            
            // Update icon
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            
            // Save preference
            localStorage.setItem('adminTheme', isDark ? 'dark' : 'light');
            
            // Show notification
            showNotification(
                `Switched to ${isDark ? 'dark' : 'light'} mode`, 
                'success'
            );
        });
    }

    // Mobile Menu Functionality
    function initMobileMenu() {
        const mobileToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.querySelector('.sidebar');
        
        if (mobileToggle) {
            mobileToggle.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileToggle.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
    }

    // Notification System
    function showNotification(message, type = 'success', duration = 3000) {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div class="d-flex align-items-center justify-content-between">
                <span>${message}</span>
                <button class="btn-close btn-close-white ms-2" onclick="this.parentElement.parentElement.remove()"></button>
            </div>
        `;
        
        container.appendChild(notification);
        
        // Show notification
        setTimeout(() => notification.classList.add('show'), 100);
        
        // Auto remove
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, duration);
    }

    // Loading Overlay
    function showLoading(show = true) {
        const overlay = document.getElementById('loadingOverlay');
        if (show) {
            overlay.classList.add('show');
        } else {
            overlay.classList.remove('show');
        }
    }

    // Enhanced Global Search
    function initGlobalSearch() {
        const searchInput = document.getElementById('globalSearch');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performGlobalSearch(e.target.value);
                }, 300);
            });
        }
    }

    function performGlobalSearch(query) {
        if (query.length < 2) return;
        
        console.log('Searching for:', query);
        // Add your search logic here
        showNotification(`Searching for "${query}"...`, 'info', 1500);
    }

    // Enhanced Page Updates
    function updatePageTitle(title, subtitle) {
        const titleEl = document.getElementById('pageTitle');
        const subtitleEl = document.getElementById('pageSubtitle');
        
        if (titleEl) titleEl.textContent = title;
        if (subtitleEl) subtitleEl.textContent = subtitle;
    }

    // Data Refresh
    function initDataRefresh() {
        const refreshBtn = document.getElementById('refreshData');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', () => {
                showLoading(true);
                showNotification('Refreshing data...', 'info', 1500);
                
                // Simulate data refresh
                setTimeout(() => {
                    showLoading(false);
                    showNotification('Data refreshed successfully!', 'success');
                    
                    // Reload current page data
                    const activePage = document.querySelector('.nav-link.active')?.getAttribute('data-page');
                    if (activePage) {
                        loadPage(activePage);
                    }
                }, 2000);
            });
        }
    }

    // Enhanced Analytics
    function generateAdvancedCharts() {
        // This would integrate with Chart.js or similar library
        console.log('Generating advanced charts...');
    }

    // Quick Stats Update
    function updateQuickStats() {
        // Real-time stats updates
        const stats = {
            onlineUsers: Math.floor(Math.random() * 50) + 10,
            todayListings: Math.floor(Math.random() * 20) + 5,
            todaySignups: Math.floor(Math.random() * 10) + 1
        };
        
        const onlineEl = document.getElementById('onlineUsers');
        const listingsEl = document.getElementById('todayListings');
        const signupsEl = document.getElementById('todaySignups');
        
        if (onlineEl) onlineEl.textContent = stats.onlineUsers;
        if (listingsEl) listingsEl.textContent = stats.todayListings;
        if (signupsEl) signupsEl.textContent = stats.todaySignups;
    }

    // Enhanced Page Load Function
    const originalLoadPage = window.loadPage;
    window.loadPage = function(page) {
        // Add fade animation
        const content = document.getElementById('content');
        content.style.opacity = '0.5';
        
        // Update page title
        const pageTitles = {
            'dashboard': { title: 'Dashboard', subtitle: 'Overview of your StudX platform' },
            'products': { title: 'Products', subtitle: 'Manage product listings' },
            'users': { title: 'Users', subtitle: 'User management and analytics' },
            'analytics': { title: 'Analytics', subtitle: 'Detailed platform analytics' },
            'sponsorship': { title: 'Sponsorship', subtitle: 'Manage sponsored content' },
            'settings': { title: 'Settings', subtitle: 'System configuration' }
        };
        
        if (pageTitles[page]) {
            updatePageTitle(pageTitles[page].title, pageTitles[page].subtitle);
        }
        
        // Call original function
        originalLoadPage(page);
        
        // Restore opacity with animation
        setTimeout(() => {
            content.style.opacity = '1';
            content.style.transition = 'opacity 0.3s ease';
        }, 100);
        
        // Update real-time stats if on dashboard
        if (page === 'dashboard') {
            updateQuickStats();
            setInterval(updateQuickStats, 30000); // Update every 30 seconds
        }
    };

    // Initialize all enhanced features
    function initEnhancedFeatures() {
        initThemeToggle();
        initMobileMenu();
        initGlobalSearch();
        initDataRefresh();
        
        // Add smooth scrolling
        document.documentElement.style.scrollBehavior = 'smooth';
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K for search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('globalSearch');
                if (searchInput) searchInput.focus();
            }
            
            // Ctrl/Cmd + Shift + D for dark mode
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                document.getElementById('themeToggle').click();
            }
        });
        
        console.log('âœ… Enhanced admin features initialized');
    }

    // Initialize enhanced features after main login
    const originalCheckLogin = checkLogin;
    checkLogin = function() {
        originalCheckLogin();
        
        // Initialize enhanced features if logged in
        if (localStorage.getItem('isLoggedIn') === 'true') {
            setTimeout(initEnhancedFeatures, 100);
        }
    };

    // Initialize enhanced features on successful login
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const rememberMe = document.getElementById('rememberMe').checked;
        
        if (username === 'admin' && password === 'admin123') {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.querySelector('.error-message').style.display = 'none';
            
            if (rememberMe) {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('rememberMe', 'true');
                localStorage.setItem('savedUsername', username);
            }
            
            loadPage('dashboard');
            attachSidebarHandlers();
            
            // Initialize enhanced features
            setTimeout(initEnhancedFeatures, 100);
            
            // Show welcome notification
            setTimeout(() => {
                showNotification('Welcome back to StudX Admin!', 'success');
            }, 500);
        } else {
            document.querySelector('.error-message').style.display = 'block';
            document.querySelector('.error-message').textContent = 'Invalid credentials. Please try again.';
        }
    });

    // Initialize
    checkLogin();

})(); // Close the main IIFE

</script>
</body>
</html>